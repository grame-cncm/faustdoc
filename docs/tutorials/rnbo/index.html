<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <title>Using Faust in RNBO with codebox~ - Faust Documentation
    </title>
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="/css/quickref.css" rel="stylesheet">
    <link href="/css/github.min.css" rel="stylesheet">
    <link href="/rail/railroad-diagrams.css" rel="stylesheet">
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <script src="../../js/bootstrap.min.js" defer></script>
    <script src="../../js/MathJax-2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"defer></script>
    <script src="../../js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
    <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="../.."><img
                    src="../../img/faustText.svg" width="150px"> </a>
            <!-- Expander button -->
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Expanded navigation -->
            <div id="navbar-collapse" class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li class="navitem">
                        <a href="../.." class="nav-link">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Manual <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../manual/introduction/" class="dropdown-item">Introduction</a>
</li>
                            
<li>
    <a href="../../manual/overview/" class="dropdown-item">Overview of the Faust Universe</a>
</li>
                            
<li>
    <a href="../../manual/quick-start/" class="dropdown-item">Quick Start</a>
</li>
                            
<li>
    <a href="../../manual/syntax/" class="dropdown-item">Faust Syntax</a>
</li>
                            
<li>
    <a href="../../manual/errors/" class="dropdown-item">Error Messages</a>
</li>
                            
<li>
    <a href="../../manual/compiler/" class="dropdown-item">Using the Compiler</a>
</li>
                            
<li>
    <a href="../../manual/options/" class="dropdown-item">Compiler Options</a>
</li>
                            
<li>
    <a href="../../manual/tools/" class="dropdown-item">faust2[...] Tools</a>
</li>
                            
<li>
    <a href="../../manual/architectures/" class="dropdown-item">Architecture Files</a>
</li>
                            
<li>
    <a href="../../manual/embedding/" class="dropdown-item">Embedding the Compiler</a>
</li>
                            
<li>
    <a href="../../manual/optimizing/" class="dropdown-item">Optimizing the Code</a>
</li>
                            
<li>
    <a href="../../manual/debugging/" class="dropdown-item">Debugging the Code</a>
</li>
                            
<li>
    <a href="../../manual/deploying/" class="dropdown-item">Deploying on the Web</a>
</li>
                            
<li>
    <a href="../../manual/remote/" class="dropdown-item">Remote Compilation</a>
</li>
                            
<li>
    <a href="../../manual/mathdoc/" class="dropdown-item">Mathematical Documentation</a>
</li>
                            
<li>
    <a href="../../manual/osc/" class="dropdown-item">OSC Support</a>
</li>
                            
<li>
    <a href="../../manual/http/" class="dropdown-item">HTTP Support</a>
</li>
                            
<li>
    <a href="../../manual/midi/" class="dropdown-item">MIDI Support</a>
</li>
                            
<li>
    <a href="../../manual/soundfiles/" class="dropdown-item">Soundfiles Support</a>
</li>
                            
<li>
    <a href="../../manual/community/" class="dropdown-item">Community</a>
</li>
                            
<li>
    <a href="../../manual/faq/" class="dropdown-item">Frequently Asked Questions</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Examples <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../examples/ambisonics/" class="dropdown-item"> ambisonics </a>
</li>
                            
<li>
    <a href="../../examples/analysis/" class="dropdown-item"> analysis </a>
</li>
                            
<li>
    <a href="../../examples/bela/" class="dropdown-item"> bela </a>
</li>
                            
<li>
    <a href="../../examples/delayEcho/" class="dropdown-item"> delayEcho </a>
</li>
                            
<li>
    <a href="../../examples/dynamic/" class="dropdown-item"> dynamic </a>
</li>
                            
<li>
    <a href="../../examples/filtering/" class="dropdown-item"> filtering </a>
</li>
                            
<li>
    <a href="../../examples/gameaudio/" class="dropdown-item"> gameaudio </a>
</li>
                            
<li>
    <a href="../../examples/generator/" class="dropdown-item"> generator </a>
</li>
                            
<li>
    <a href="../../examples/misc/" class="dropdown-item"> misc </a>
</li>
                            
<li>
    <a href="../../examples/phasing/" class="dropdown-item"> phasing </a>
</li>
                            
<li>
    <a href="../../examples/physicalModeling/" class="dropdown-item"> physicalModeling </a>
</li>
                            
<li>
    <a href="../../examples/pitchShifting/" class="dropdown-item"> pitchShifting </a>
</li>
                            
<li>
    <a href="../../examples/psychoacoustic/" class="dropdown-item"> psychoacoustic </a>
</li>
                            
<li>
    <a href="../../examples/reverb/" class="dropdown-item"> reverb </a>
</li>
                            
<li>
    <a href="../../examples/smartKeyboard/" class="dropdown-item"> smartKeyboard </a>
</li>
                            
<li>
    <a href="../../examples/spat/" class="dropdown-item"> spat </a>
</li>
                            
<li>
    <a href="../../rsrc/examples.zip" class="dropdown-item"> Download examples </a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tutorials <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../workshops/2020-04-10-faust-juce/" class="dropdown-item">Faust & JUCE</a>
</li>
                            
<li>
    <a href="../teensy/" class="dropdown-item">DSP on the Teensy With Faust</a>
</li>
                            
<li>
    <a href="../esp32/" class="dropdown-item">DSP on the ESP-32 With Faust</a>
</li>
                            
<li>
    <a href="../basic-osc/" class="dropdown-item">Making a Sine Oscillator From Scratch</a>
</li>
                            
<li>
    <a href="../summation/" class="dropdown-item">RMS and Summation in Faust</a>
</li>
                            
<li>
    <a href="../box-api/" class="dropdown-item">Using the box API</a>
</li>
                            
<li>
    <a href="../signal-api/" class="dropdown-item">Using the signal API</a>
</li>
                            
<li>
    <a href="../julia/" class="dropdown-item">Using Faust in Julia</a>
</li>
                            
<li>
    <a href="../cmajor/" class="dropdown-item">Using Faust in Cmajor</a>
</li>
                            
<li>
    <a href="../jsfx/" class="dropdown-item">Using Faust in JSFX</a>
</li>
                            
<li>
    <a href="./" class="dropdown-item active">Using Faust in RNBO with codebox~</a>
</li>
                            
<li>
    <a href="../debugging/" class="dropdown-item">Advanced debugging with interp-tracer</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Workshops <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../workshops/2018-12-01-paw/" class="dropdown-item"> 2018-12-01 PAW </a>
</li>
                            
<li>
    <a href="../../workshops/2020-03-24-faust-citi/" class="dropdown-item"> 2020-03-24 CITI </a>
</li>
                            
<li>
    <a href="../../workshops/2020-04-10-faust-101/" class="dropdown-item"> 2020-04-10 Faust 101 </a>
</li>
                            
<li>
    <a href="../../workshops/2020-04-10-faust-juce/" class="dropdown-item"> 2020-04-10 Faust & JUCE </a>
</li>
                            
<li>
    <a href="../../workshops/2020-11-21-faust-vcvrack/" class="dropdown-item"> 2020-11-21 Faust & VCV Rack </a>
</li>
                        </ul>
                    </li>
                    <li class="navitem">
                        <a href="../../about/" class="nav-link">About</a>
                    </li>
                </ul>

                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    

    <div class="container">
        <div class="row"><div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#using-faust-in-rnbo-with-codebox" class="nav-link">Using Faust in RNBO with codebox~</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#who-is-this-tutorial-for" class="nav-link">Who is this tutorial for?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-command-line-tools" class="nav-link">Using command line tools</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#generating-codebox-code" class="nav-link">Generating codebox~ code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#looking-at-the-generated-code" class="nav-link">Looking at the generated code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#testing-the-generated-codebox-code" class="nav-link">Testing the generated codebox~ code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-the-faust2rnbo-tool" class="nav-link">Using the faust2rnbo tool</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#bargraph-handling" class="nav-link">Bargraph handling</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#midi-control" class="nav-link">MIDI control</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#polyphonic-instruments" class="nav-link">Polyphonic instruments</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#polyphonic-instruments-with-an-effect" class="nav-link">Polyphonic instruments with an effect</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-the-faust-web-ide" class="nav-link">Using the Faust Web IDE</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#generating-a-rnbo-patch" class="nav-link">Generating a RNBO patch</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#generating-the-rnbo-patch-in-polyphonic-mode" class="nav-link">Generating the RNBO patch in polyphonic mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#generating-the-rnbo-patch-in-polyphonic-mode-with-a-global-effect" class="nav-link">Generating the RNBO patch in polyphonic mode with a global effect</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#generating-the-rnbo-patch-from-a-faust-dsp-program-found-in-the-web" class="nav-link">Generating the RNBO patch from a Faust DSP program found in the web</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
            <div class="col-md-9 main-container" role="main">

<h1 id="using-faust-in-rnbo-with-codebox">Using Faust in RNBO with codebox~</h1>
<p>In this tutorial, we present how <a href="https://faust.grame.fr">Faust</a> can be used with <a href="https://rnbo.cycling74.com">RNBO</a>, a library and toolchain that can take Max-like patches, export them as portable code, and directly compile that code to targets like a VST, a Max External, or a Raspberry Pi. DSP programs can be compiled to the internal <a href="https://rnbo.cycling74.com/codebox">codebox~</a> sample level scripting language.
Compiling Faust DSP to codebox~ code will allow to take profit of hundreds of DSP building blocks implemented in the <a href="https://faustlibraries.grame.fr">Faust Libraries</a>, ready to use <a href="../../examples/ambisonics/">Examples</a>, any DSP program developed in more than 200 projects listed in the <a href="https://faust.grame.fr/community/powered-by-faust/">Powered By Faust</a> page, or Faust DSP programs found on the net.</p>
<h4 id="who-is-this-tutorial-for">Who is this tutorial for?</h4>
<p>The <a href="#using-command-line-tools">first section</a> assumes a working <a href="https://github.com/grame-cncm/faust">Faust</a> compiler installed on the machine, so is more designed for regular Faust users. The <a href="#using-the-faust-web-ide">second section</a> is better suited for RNBO users who want to discover Faust.  </p>
<h2 id="using-command-line-tools">Using command line tools</h2>
<h3 id="generating-codebox-code">Generating codebox~ code</h3>
<p>Assuming you've <a href="https://faust.grame.fr/downloads/">installed the <strong>faust</strong> compiler</a>, starting from the following DSP <strong>osc.dsp</strong> program:</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust0/exfaust0.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

vol = hslider("volume [unit:dB]", 0, -96, 0, 0.1) : ba.db2linear : si.smoo;
freq1 = hslider("freq1 [unit:Hz]", 1000, 20, 3000, 1);
freq2 = hslider("freq2 [unit:Hz]", 200, 20, 3000, 1);

process = vgroup("Oscillator", os.osc(freq1) * vol, os.osc(freq2) * vol);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<p>The codebox~ code can be generated using the following line (note the use of <code>-double</code> option, the default sample format in RNBO/codebox~):</p>
<pre><code class="language-bash">faust -lang codebox -double osc.dsp -o osc.codebox
</code></pre>
<p>This will generate a series of functions to init, update parameters and compute audio frames.</p>
<h3 id="looking-at-the-generated-code">Looking at the generated code</h3>
<p>The generated code contains a sequence of parameters definitions with their min, max, step and default values:</p>
<pre><code>// Params
@param({min: 2e+01, max: 3e+03, step: 0.1}) freq1 = 1e+03;
@param({min: 2e+01, max: 3e+03, step: 0.1}) freq2 = 2e+02;
@param({min: -96.0, max: 0.0, step: 0.1}) volume = 0.0;
</code></pre>
<p>Next the declaration of the DSP structure using the <code>@state</code> decorator, creating a state that persists across the lifetime of the codebox object. Scalar and arrays with the proper type are created:</p>
<pre><code>// Fields
@state fSampleRate_cb : Int = 0;
@state fConst1_cb : number = 0;
@state fHslider0_cb : number = 0;
@state fConst2_cb : number = 0;
@state iVec0_cb = new FixedIntArray(2);
@state fRec0_cb = new FixedDoubleArray(2);
@state fConst3_cb : number = 0;
@state fHslider1_cb : number = 0;
@state fRec2_cb = new FixedDoubleArray(2);
@state fHslider2_cb : number = 0;
@state fRec3_cb = new FixedDoubleArray(2);
@state iVec1_cb = new FixedIntArray(2);
@state iRec1_cb = new FixedIntArray(2);
@state ftbl0mydspSIG0_cb = new FixedDoubleArray(65536);
@state fUpdated : Int = 0;
@state fControl_cb = new FixedDoubleArray(3);
</code></pre>
<p>Next the DSP init code, which is added in <a href="https://rnbo.cycling74.com/codebox#special-functions">dspsetup</a>, only available in codebox~ where it will be called each time audio is turned on in Max (which is basically every time the audio state is toggled, or the sample rate or vector size is changed). Here the DSP state is initialized using the RNBO current sample rate: </p>
<pre><code>// Init
function dspsetup() {
    fUpdated = true;
    for (let l2_re0_cb : Int = 0; (l2_re0_cb &lt; 2); l2_re0_cb = (l2_re0_cb + 1)) {
        iVec1_cb[l2_re0_cb] = 0;
    }
    for (let l3_re0_cb : Int = 0; (l3_re0_cb &lt; 2); l3_re0_cb = (l3_re0_cb + 1)) {
        iRec1_cb[l3_re0_cb] = 0;
    }
    for (let i1_re0_cb : Int = 0; (i1_re0_cb &lt; 65536); i1_re0_cb = (i1_re0_cb + 1)) {
        iVec1_cb[0] = 1;
        iRec1_cb[0] = ((iVec1_cb[1] + iRec1_cb[1]) % 65536);
        ftbl0mydspSIG0_cb[i1_re0_cb] = sin((9.587379924285257e-05 * iRec1_cb[0]));
        iVec1_cb[1] = iVec1_cb[0];
        iRec1_cb[1] = iRec1_cb[0];
    }
    fHslider0_cb = 0.0;
    fHslider1_cb = 1e+03;
    fHslider2_cb = 2e+02;
    ...
    ...   
    fSampleRate_cb = samplerate();
    let fConst0_cb : number = min(1.92e+05, max(1.0, fSampleRate_cb));
    fConst1_cb = (44.1 / fConst0_cb);
    fConst2_cb = (1.0 - fConst1_cb);
    fConst3_cb = (1.0 / fConst0_cb);
}
</code></pre>
<p>Parameters handling is separated in two functions: <code>control</code> is called each time a parameter has changed:</p>
<pre><code>// Control
function control() {
    fControl_cb[0] = (fConst1_cb * pow(1e+01, (0.05 * fHslider0_cb)));
    fControl_cb[1] = (fConst3_cb * fHslider1_cb);
    fControl_cb[2] = (fConst3_cb * fHslider2_cb);
}
</code></pre>
<p>And the actual change is triggered when at least one parameter has changed, controlled by the state of <code>fUpdated</code>global variable:</p>
<pre><code>// Update parameters
function update(freq1,freq2,volume) {
    fUpdated = int(fUpdated) | (freq1 != fHslider1_cb); fHslider1_cb = freq1;
    fUpdated = int(fUpdated) | (freq2 != fHslider2_cb); fHslider2_cb = freq2;
    fUpdated = int(fUpdated) | (volume != fHslider0_cb); fHslider0_cb = volume;
    if (fUpdated) { fUpdated = false; control(); }
}
</code></pre>
<p>Finally <code>compute</code> process the audio inputs and produces audio outputs:</p>
<pre><code>// Update parameters
/ Compute one frame
function compute() {
    iVec0_cb[0] = 1;
    fRec0_cb[0] = (fControl_cb[0] + (fConst2_cb * fRec0_cb[1]));
    let iTemp0_cb : Int = (1 - iVec0_cb[1]);
    let fTemp1_cb : number = ((iTemp0_cb) ? 0.0 : (fControl_cb[1] + fRec2_cb[1]));
    fRec2_cb[0] = (fTemp1_cb - floor(fTemp1_cb));
    output0_cb = (fRec0_cb[0] * ftbl0mydspSIG0_cb[max(0, min(int((65536.0 * fRec2_cb[0])), 65535))]);
    let fTemp2_cb : number = ((iTemp0_cb) ? 0.0 : (fControl_cb[2] + fRec3_cb[1]));
    fRec3_cb[0] = (fTemp2_cb - floor(fTemp2_cb));
    output1_cb = (fRec0_cb[0] * ftbl0mydspSIG0_cb[max(0, min(int((65536.0 * fRec3_cb[0])), 65535))]);
    iVec0_cb[1] = iVec0_cb[0];
    fRec0_cb[1] = fRec0_cb[0];
    fRec2_cb[1] = fRec2_cb[0];
    fRec3_cb[1] = fRec3_cb[0];
    return [output0_cb,output1_cb];
}
</code></pre>
<p>With this code in place, the following sequence of operations is done at each sample:</p>
<pre><code>// Update parameters
update(freq1,freq2,volume);
// Compute one frame
outputs = compute();
// Write the outputs
out1 = outputs[0];
out2 = outputs[1];
</code></pre>
<p>Note that the generated code uses the so-called <a href="../../manual/compiler/#structure-of-the-generated-code">scalar code generation model</a>, the default one, where the compiled sample generation code is done in <code>compute</code>. </p>
<h3 id="testing-the-generated-codebox-code">Testing the generated codebox~ code</h3>
<p>To be tested, the generated code has to be pasted in a codebox~ component in an encompassing RNBO patch, with additional patching to add the needed audio inputs/outputs and control parameters. Thus a more integrated and simpler model is to use the <strong>faust2rnbo</strong> tool.  </p>
<h2 id="using-the-faust2rnbo-tool">Using the faust2rnbo tool</h2>
<p>The <a href="https://github.com/grame-cncm/faust/tree/master-dev/architecture/max-msp#faust2rnbo">faust2rnbo</a> tool transforms a Faust DSP program into a RNBO patch containing a <code>rnbo~</code> object and including the codebox code (generated using the <a href="https://github.com/grame-cncm/faust/tree/master-dev/compiler/generator/codebox">codebox backend</a>) as a subpatch. Needed audio inputs/outputs and parameters (with the proper name, default, min and max values) are automatically added in the patch. Additional options allow to generate a special version of the RNBO patch used in the testing infrastructure. The code is written in Python and uses the very powerful <a href="https://github.com/shakfu/py2max">py2max</a> library to generate the maxpat JSON format.</p>
<pre><code class="language-bash">faust2rnbo -h
Usage: faust2rnbo [options] [Faust options] &lt;file.dsp&gt;
Compiles Faust programs to RNBO patches
Options:
   -midi : activates MIDI control
   -nvoices &lt;num&gt; : produces a polyphonic DSP with &lt;num&gt; voices, ready to be used with MIDI events
   -effect &lt;effect.dsp&gt; : generates a polyphonic DSP connected to a global output effect, ready to be used with MIDI or OSC
   -effect auto : generates a polyphonic DSP connected to a global output effect defined as 'effect' in &lt;file.dsp&gt;, ready to be used with MIDI or OSC
   -compile : to trigger C++ compilation at load time
   -test : to generate special 'RB_XX' prefix for parameters (for testing)
   -sp : to generate codebox subpatcher as a file.rnbopat file (and possibly file_effect.rnbopat)
   -cpp_path &lt;path&gt; : to set C++ export folder
   -cpp_filename &lt;filename&gt; : to set C++ export filename
   Faust options : any option (e.g. -vec -vs 8...). See the Faust compiler documentation.
</code></pre>
<p>The resulting patch contains:</p>
<ul>
<li>an audio <code>adc~</code> input automatically connected to the <code>rnbo~</code> object (when the DSP has audio inputs)</li>
<li>an audio <code>dac~</code> output automatically connected with the <code>rnbo~</code> object. </li>
</ul>
<p>So the following command:</p>
<pre><code class="language-bash">faust2rnbo osc.dsp 
</code></pre>
<p>will directly compile the <code>osc.dsp</code> file and generate the <code>osc.maxpat</code> file, that can be opened in Max/MSP, with the following user-interface:</p>
<p><img src="img/faust-rnbo1.png" class="mx-auto d-block" width="100%">
<center><em>Generated RNBO patch</em></center></p>
<p>and with the <code>rnbo~</code> subpatcher containing the codebox object as well as the parameter control machinery:</p>
<p><img src="img/faust-rnbo2.png" class="mx-auto d-block" width="100%">
<center><em><code>rnbo~</code> subpatcher with parameter control machinery (after manual editing)</em></center></p>
<p>Note that the <code>rnbo~</code> object subpatcher can be generated using the <code>-sp</code> option and possibly used in other contexts as explained on <a href="https://rnbo.cycling74.com/learn/abstractions">this page</a>. So <code>faust2rnbo -sp osc.dsp</code> will create both <code>osc.maxpat</code> and <code>osc.rnbopat</code> files. In this case the main patch uses the <a href="https://rnbo.cycling74.com/learn/rnbo-abstractions-and-rnbopat-files#parameters-in-subpatchers-and-abstractions">patchername/paramname</a> parameter naming convention:</p>
<p><img src="img/faust-rnbo1-bis.png" class="mx-auto d-block" width="100%">
<center><em>Generated RNBO patch in -sp mode </em></center></p>
<p>and the subpatcher contains a <code>p</code> object to load and use the <code>osc.rnbopat</code> file:</p>
<p><img src="img/faust-rnbo1-ter.png" class="mx-auto d-block" width="100%">
<center><em><code>rnbo~</code> subpatcher with parameter control machinery in <code>p</code> mode</em></center></p>
<h3 id="bargraph-handling">Bargraph handling</h3>
<p>In Faust, bargraph are typically used to analyze audio signals where computed values are sent at control rate. This cannot be directly done in the RNBO model where only audio signals can be sent from the codebox code. So additional audio outputs are created for bargraph, and will be sampled (using <code>snapshot~</code> and <code>change</code>) and be connected to <code>param</code> objects, like input controllers.</p>
<p>So for instance the following example: </p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust1/exfaust1.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = vmeter,hmeter
with {
    vmeter(x) = attach(x, envelop(x) : vbargraph("vmeter dB [midi:ctrl 1]", -96, 10));
    hmeter(x) = attach(x, envelop(x) : hbargraph("hmeter dB [midi:ctrl 2]", -96, 10));

    envelop = abs : max(ba.db2linear(-96)) : ba.linear2db : min(10) : max ~ -(96.0/ma.SR);
};

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<p>compiled with <strong>faust2rnbo</strong> will create a subpatcher with 2 audio inputs and 4 audio outputs (2 real ones and 2 used for bargraph), and the user-interface:</p>
<p><img src="img/faust-rnbo2-bis.png" class="mx-auto d-block" width="100%">
<center><em><code>rnbo~</code> subpatcher with additional audio outputs for bargraph</em></center></p>
<p>and the main patch with parameters displaying the bargraph values:</p>
<p><img src="img/faust-rnbo2-ter.png" class="mx-auto d-block" width="100%">
<center><em>RNBO main patch displaying bargraph values</em></center></p>
<h3 id="midi-control">MIDI control</h3>
<p>Control of parameters with MIDI can be activated using the <code>-midi</code> option, or using the <a href="../../manual/midi/#configuring-midi-in-faust">declare options "[midi:on]";</a> syntax in the DSP code. The patch will then contain <code>midiin/midiout</code> objects at global level and specialized <code>ctlin/notein etc.</code> objects in the codebox subpatcher with the appropriate <code>scale</code> object to map the MIDI message range on the target parameter range.</p>
<p>So for instance the MIDI augmented example: </p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust2/exfaust2.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

declare options "[midi:on]";

vol = hslider("volume [unit:dB][midi: ctrl 7]", 0, -96, 0, 0.1) : ba.db2linear : si.smoo;
freq1 = hslider("freq1 [unit:Hz][midi: ctrl 1]", 1000, 20, 3000, 0.1);
freq2 = hslider("freq2 [unit:Hz][midi: ctrl 2]", 200, 20, 3000, 0.1);

process = vgroup("Oscillator", os.osc(freq1) * vol, os.osc(freq2) * vol);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<p>can now be controlled with MIDI volume (ctrl 7), ctrl 1 and ctrl 2 for each channel frequency. Modification done on the parameters in the GUI will be sent as MIDI output messages.</p>
<p>And the following command:</p>
<pre><code class="language-bash">faust2rnbo -midi osc.dsp 
</code></pre>
<p>will compile a <code>osc.maxpat</code> file containing additional <code>midiin/midiout</code> objects, with the following user-interface:</p>
<p><img src="img/faust-rnbo3.png" class="mx-auto d-block" width="100%">
<center><em>Generated RNBO patch with MIDI control</em></center></p>
<h3 id="polyphonic-instruments">Polyphonic instruments</h3>
<p>When the DSP follows the <a href="../../manual/midi/#midi-polyphony-support">polyphonic ready instrument</a> convention, it can be activated in MIDI controllable polyphonic mode. So the following DSP program:</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust3/exfaust3.svg" class="mx-auto d-block">
<faust-editor><!--

declare options "[midi:on][nvoices:8]";
import("stdfaust.lib");

process = vgroup("Organ", voice(freq) * gain * en.adsr(0.1, 0.1, 0.8, 0.3, button("gate"))) * master <: (_,_)
with {
    master = hslider("master [midi:ctrl 7]", 0.5, 0, 1, 0.01);
    gain = hslider("gain", 0.5, 0, 1, 0.01);
    freq = hslider("freq", 500, 200, 3000, 0.1);
    voice(freq) = os.osc(freq) + os.osc(freq*2)*0.5 + os.osc(freq*3)*0.25;
};

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<p>compiled with the command:</p>
<pre><code class="language-bash">faust2rnbo -midi -nvoices 12 organ.dsp 
</code></pre>
<p>will create a patch containing a <code>rnbo~</code> object with 12 voices, and with a <code>notein</code> object added in the subpatcher correctly connected to the appropriate <em>freq/gain/gate</em> aware parameters. Additional mapping depending of the <a href="../../manual/midi/#standard-polyphony-parameters">convention used</a> to describe the pitch (freq or key) or gain (gain or velocity) will be added when needed, with the generated user-interface:</p>
<p><img src="img/faust-rnbo4.png" class="mx-auto d-block" width="100%">
<center><em>Generated polyphonic RNBO patch with MIDI control</em></center></p>
<p>In the DSP, note that the master slider can be controlled using the crl 7 (= Volume) MIDI message. </p>
<p>Note that here again, the <code>rnbo~</code> object subpatcher can be generated using the <code>-sp</code> option and possibly used in other context.</p>
<h3 id="polyphonic-instruments-with-an-effect">Polyphonic instruments with an effect</h3>
<p>The following polyphonic ready instrument DSP, with an <a href="../../manual/midi/#audio-effects-and-polyphonic-synthesizer">integrated effect</a>, can be converted to a polyphonic MIDI ready patch:</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust4/exfaust4.svg" class="mx-auto d-block">
<faust-editor><!--

declare options "[midi:on][nvoices:8]";
import("stdfaust.lib");

process = vgroup("Organ", voice(freq) * gain * en.adsr(0.1, 0.1, 0.8, 0.3, button("gate"))) * master <: (_,_)
with {
    master = hslider("master [midi:ctrl 7]", 0.5, 0, 1, 0.01);
    gain = hslider("gain", 0.5, 0, 1, 0.01);
    freq = hslider("freq", 500, 200, 3000, 0.1);
    voice(freq) = os.osc(freq) + os.osc(freq*2)*0.5 + os.osc(freq*3)*0.25;
};

effect = dm.freeverb_demo;

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<p>To be compiled with the following:</p>
<pre><code class="language-bash">faust2rnbo -midi -nvoices 16 -effect auto organ2.dsp 
</code></pre>
<p>with the generated user-interface and the polyphonic DSP <code>rnbo~</code> object, using the <code>p</code> abstraction model to load and activate the polyphonic instrument (as a <code>organ2.rnbopat</code> file), connected to the global effect (as a <code>organ2_effect.rnbopat</code> file). Having a single <code>rnbo~</code> object with the two embedded subpachers is mandatory  to properly create the exported project:</p>
<p><img src="img/faust-rnbo5.png" class="mx-auto d-block" width="100%">
<center><em>Generated polyphonic RNBO patch with MIDI control</em></center></p>
<p>and the <code>rnbo~</code> subpather:
<img src="img/faust-rnbo5-bis.png" class="mx-auto d-block" width="100%">
<center><em><code>rnbo~</code> subpatcher with the polyphonic instrument and global effect as <code>p</code>abstractions</em></center></p>
<h2 id="using-the-faust-web-ide">Using the Faust Web IDE</h2>
<p>Faust DSP programs can be written, tested in the <a href="https://faustide.grame.fr/">Faust Web IDE</a> and generated as RNBO patches.</p>
<h3 id="generating-a-rnbo-patch">Generating a RNBO patch</h3>
<p>The output as a RNBO patch can directly be generated using the <em>Platform = rnbo</em> and <em>Architecture = rnbo</em> export options. The resulting <em>foo</em> folder is self-contained, containing the <code>foo.maxpat</code> file.to be opened with Max/MSP.</p>
<p><img src="img/export.png" class="mx-auto d-block" width="40%">
<center><em>Exporting the code</em></center> </p>
<h3 id="generating-the-rnbo-patch-in-polyphonic-mode">Generating the RNBO patch in polyphonic mode</h3>
<p>DSP programs following the polyphonic <a href="../../manual/midi/#midi-polyphony-support">freq/gate/gain convention</a> can be generated using the <em>Platform = rnbo</em> and <em>Architecture = rnbo-poly</em> export options. The resulting <em>foo</em> folder is self-contained, containing the <code>foo.maxpat</code> file to be opened with Max/MSP.</p>
<h3 id="generating-the-rnbo-patch-in-polyphonic-mode-with-a-global-effect">Generating the RNBO patch in polyphonic mode with a global effect</h3>
<p>DSP programs following the polyphonic <a href="../../manual/midi/#midi-polyphony-support">freq/gate/gain convention</a> with and an <a href="../../manual/midi/#audio-effects-and-polyphonic-synthesizer">integrated effect</a> can be generated using the <em>Platform = rnbo</em> and <em>Architecture = rnbo-poly-effect</em> export options. The resulting <em>foo</em> folder is self-contained, containing the <code>foo.maxpat</code>, <code>foo.rnbopat</code>and <code>foo_effect.rnbopat</code> files (using the <code>p</code> abstraction model), with <code>foo.maxpat</code> file to be opened with Max/MSP.</p>
<h3 id="generating-the-rnbo-patch-from-a-faust-dsp-program-found-in-the-web">Generating the RNBO patch from a Faust DSP program found in the web</h3>
<p>Faust DSP programs found on the Web can also be converted:</p>
<ul>
<li>
<p>for instance the <a href="https://faust.grame.fr/community/powered-by-faust/#fverb">fverb</a> listed on the <a href="https://faust.grame.fr/community/powered-by-faust/">Powered By Faust</a> page. The DSP content can simply be loaded using the <code>https://faustide.grame.fr/?code=URL</code> syntax, so with the following URL: <a href="https://faustide.grame.fr/?code=https://raw.githubusercontent.com/jpcima/fverb/master/fverb.dsp">https://faustide.grame.fr/?code=https://raw.githubusercontent.com/jpcima/fverb/master/fverb.dsp</a>, tested in the Faust Web IDE, then converted in a RNBO patch as already showed.</p>
</li>
<li>
<p>examples of the <a href="https://faustplayground.grame.fr/">faustplayground</a> platform can be <a href="https://github.com/grame-cncm/faustplayground/tree/master/public/faust-modules">found here</a> and possibly converted. </p>
</li>
</ul></div>
        </div>
    </div>

    <footer class="col-md-12">
        <hr>
        <p>Copyright &copy; 2020-2025 <a href="https://www.grame.fr">Grame-CNCM</a></p>
    </footer>
    <script>
        var base_url = "../..",
        shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
    </script>
    <script src="../../js/base.js" defer></script>
    <script src="/js/faust-web-component.js" defer></script>
    <script src="../../search/main.js" defer></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
