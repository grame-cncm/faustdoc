<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <title>6 audio - Faust Documentation
    </title>
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link href="/css/quickref.css" rel="stylesheet">
    <link href="/rail/railroad-diagrams.css" rel="stylesheet">

    <script src="../../js/jquery-1.10.2.min.js" defer></script>
    <script src="../../js/bootstrap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body>
    <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="../.."><img
                    src="../../img/faustText.svg" width="150px"> </a>
            <!-- Expander button -->
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Expanded navigation -->
            <div id="navbar-collapse" class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li class="navitem">
                        <a href="../.." class="nav-link">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Manual <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../manual/introduction/" class="dropdown-item">Introduction</a>
</li>
                            
<li>
    <a href="../../manual/overview/" class="dropdown-item">Overview of the Faust Universe</a>
</li>
                            
<li>
    <a href="../../manual/quick-start/" class="dropdown-item">Quick Start</a>
</li>
                            
<li>
    <a href="../../manual/syntax/" class="dropdown-item">Faust Syntax</a>
</li>
                            
<li>
    <a href="../../manual/errors/" class="dropdown-item">Error Messages</a>
</li>
                            
<li>
    <a href="../../manual/compiler/" class="dropdown-item">Using the Compiler</a>
</li>
                            
<li>
    <a href="../../manual/options/" class="dropdown-item">Compiler Options</a>
</li>
                            
<li>
    <a href="../../manual/tools/" class="dropdown-item">faust2[...] Tools</a>
</li>
                            
<li>
    <a href="../../manual/architectures/" class="dropdown-item">Architecture Files</a>
</li>
                            
<li>
    <a href="../../manual/embedding/" class="dropdown-item">Embedding the Compiler</a>
</li>
                            
<li>
    <a href="../../manual/optimizing/" class="dropdown-item">Optimizing the Code</a>
</li>
                            
<li>
    <a href="../../manual/debugging/" class="dropdown-item">Debugging the Code</a>
</li>
                            
<li>
    <a href="../../manual/deploying/" class="dropdown-item">Deploying on the Web</a>
</li>
                            
<li>
    <a href="../../manual/remote/" class="dropdown-item">Remote Compilation</a>
</li>
                            
<li>
    <a href="../../manual/mathdoc/" class="dropdown-item">Mathematical Documentation</a>
</li>
                            
<li>
    <a href="../../manual/osc/" class="dropdown-item">OSC Support</a>
</li>
                            
<li>
    <a href="../../manual/http/" class="dropdown-item">HTTP Support</a>
</li>
                            
<li>
    <a href="../../manual/midi/" class="dropdown-item">MIDI Support</a>
</li>
                            
<li>
    <a href="../../manual/soundfiles/" class="dropdown-item">Soundfiles Support</a>
</li>
                            
<li>
    <a href="../../manual/community/" class="dropdown-item">Community</a>
</li>
                            
<li>
    <a href="../../manual/faq/" class="dropdown-item">Frequently Asked Questions</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Examples <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../examples/ambisonics/" class="dropdown-item"> ambisonics </a>
</li>
                            
<li>
    <a href="../../examples/analysis/" class="dropdown-item"> analysis </a>
</li>
                            
<li>
    <a href="../../examples/bela/" class="dropdown-item"> bela </a>
</li>
                            
<li>
    <a href="../../examples/delayEcho/" class="dropdown-item"> delayEcho </a>
</li>
                            
<li>
    <a href="../../examples/dynamic/" class="dropdown-item"> dynamic </a>
</li>
                            
<li>
    <a href="../../examples/filtering/" class="dropdown-item"> filtering </a>
</li>
                            
<li>
    <a href="../../examples/gameaudio/" class="dropdown-item"> gameaudio </a>
</li>
                            
<li>
    <a href="../../examples/generator/" class="dropdown-item"> generator </a>
</li>
                            
<li>
    <a href="../../examples/misc/" class="dropdown-item"> misc </a>
</li>
                            
<li>
    <a href="../../examples/phasing/" class="dropdown-item"> phasing </a>
</li>
                            
<li>
    <a href="../../examples/physicalModeling/" class="dropdown-item"> physicalModeling </a>
</li>
                            
<li>
    <a href="../../examples/pitchShifting/" class="dropdown-item"> pitchShifting </a>
</li>
                            
<li>
    <a href="../../examples/psychoacoustic/" class="dropdown-item"> psychoacoustic </a>
</li>
                            
<li>
    <a href="../../examples/reverb/" class="dropdown-item"> reverb </a>
</li>
                            
<li>
    <a href="../../examples/SAM/" class="dropdown-item"> SAM </a>
</li>
                            
<li>
    <a href="../../examples/smartKeyboard/" class="dropdown-item"> smartKeyboard </a>
</li>
                            
<li>
    <a href="../../examples/spat/" class="dropdown-item"> spat </a>
</li>
                            
<li>
    <a href="../../rsrc/examples.zip" class="dropdown-item"> Download examples </a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tutorials <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../workshops/2020-04-10-faust-juce/" class="dropdown-item">Faust & JUCE</a>
</li>
                            
<li>
    <a href="../../tutorials/teensy/" class="dropdown-item">DSP on the Teensy With Faust</a>
</li>
                            
<li>
    <a href="../../tutorials/esp32/" class="dropdown-item">DSP on the ESP-32 With Faust</a>
</li>
                            
<li>
    <a href="../../tutorials/basic-osc/" class="dropdown-item">Making a Sine Oscillator From Scratch</a>
</li>
                            
<li>
    <a href="../../tutorials/summation/" class="dropdown-item">RMS and Summation in Faust</a>
</li>
                            
<li>
    <a href="../../tutorials/box-api/" class="dropdown-item">Using the box API</a>
</li>
                            
<li>
    <a href="../../tutorials/signal-api/" class="dropdown-item">Using the signal API</a>
</li>
                            
<li>
    <a href="../../tutorials/julia/" class="dropdown-item">Using Faust in Julia</a>
</li>
                            
<li>
    <a href="../../tutorials/cmajor/" class="dropdown-item">Using Faust in Cmajor</a>
</li>
                            
<li>
    <a href="../../tutorials/jsfx/" class="dropdown-item">Using Faust in JSFX</a>
</li>
                            
<li>
    <a href="../../tutorials/rnbo/" class="dropdown-item">Using Faust in RNBO with codebox~</a>
</li>
                            
<li>
    <a href="../../tutorials/debugging/" class="dropdown-item">Advanced debugging with interp-tracer</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Workshops <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../workshops/2018-12-01-paw/" class="dropdown-item"> 2018-12-01 PAW </a>
</li>
                            
<li>
    <a href="../../workshops/2020-03-24-faust-citi/" class="dropdown-item"> 2020-03-24 CITI </a>
</li>
                            
<li>
    <a href="../../workshops/2020-04-10-faust-101/" class="dropdown-item"> 2020-04-10 Faust 101 </a>
</li>
                            
<li>
    <a href="../../workshops/2020-04-10-faust-juce/" class="dropdown-item"> 2020-04-10 Faust & JUCE </a>
</li>
                            
<li>
    <a href="../../workshops/2020-11-21-faust-vcvrack/" class="dropdown-item"> 2020-11-21 Faust & VCV Rack </a>
</li>
                        </ul>
                    </li>
                    <li class="navitem">
                        <a href="../../about/" class="nav-link">About</a>
                    </li>
                </ul>

                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    

    <div class="container">
        <div class="row"><div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#architecture-files" class="nav-link">Architecture files</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#audio-architecture-modules" class="nav-link">Audio architecture modules</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ui-architecture-modules" class="nav-link">UI architecture modules</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#active-widgets" class="nav-link">Active widgets</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#passive-widgets" class="nav-link">Passive widgets</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#widgets-layout" class="nav-link">Widgets layout</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#metadata" class="nav-link">Metadata</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#developing-a-new-architecture-file" class="nav-link">Developing a new architecture file</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
            <div class="col-md-9 main-container" role="main">

<script src='/rail/railroad-diagrams.js'></script>

<h1 id="architecture-files">Architecture files</h1>
<p><a name="audio"></a></p>
<p>A <span class="smallcaps">Faust</span> program describes a <strong>signal processor</strong>, a pure computation that maps <strong>input signals</strong> to <strong>output signals</strong>. It says nothing about audio drivers or GUI toolkits. This missing information is provided by <strong>architecture files</strong>. </p>
<p>An <strong>architecture file</strong> describes how to relate a <span class="smallcaps">Faust</span> program to the external world, in particular the audio drivers and the user interface to be used. This approach allows a single <span class="smallcaps">Faust</span> program to be easily deployed to a large variety of audio standards (Max/MSP externals, PD externals, VST plugins, CoreAudio applications, Jack applications, iPhone, etc.). </p>
<p>The architecture to be used is specified at compile time with the <span class="lstinline">-a</span> options. For example
<span class="lstinline">faust -a jack-gtk.cpp foo.dsp</span> indicates to use the Jack GTK architecture when compiling <span class="lstinline">foo.dsp</span>.</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>File name</strong></td>
<td><strong>Description</strong></td>
<td></td>
</tr>
<tr>
<td>alchemy-as.cpp</td>
<td>Flash - ActionScript plugin</td>
<td></td>
</tr>
<tr>
<td>ca-qt.cpp</td>
<td>CoreAudio QT4 standalone application</td>
<td></td>
</tr>
<tr>
<td>jack-gtk.cpp</td>
<td>JACK GTK standalone application</td>
<td></td>
</tr>
<tr>
<td>jack-qt.cpp</td>
<td>JACK QT4 standalone application</td>
<td></td>
</tr>
<tr>
<td>jack-console.cpp</td>
<td>JACK command line application</td>
<td></td>
</tr>
<tr>
<td>jack-internal.cpp</td>
<td>JACK server plugin</td>
<td></td>
</tr>
<tr>
<td>alsa-gtk.cpp</td>
<td>ALSA GTK standalone application</td>
<td></td>
</tr>
<tr>
<td>alsa-qt.cpp</td>
<td>ALSA QT4 standalone application</td>
<td></td>
</tr>
<tr>
<td>oss-gtk.cpp</td>
<td>OSS GTK standalone application</td>
<td></td>
</tr>
<tr>
<td>pa-gtk.cpp</td>
<td>PortAudio GTK standalone application</td>
<td></td>
</tr>
<tr>
<td>pa-qt.cpp</td>
<td>PortAudio QT4 standalone application</td>
<td></td>
</tr>
<tr>
<td>max-msp.cpp</td>
<td>Max/MSP external</td>
<td></td>
</tr>
<tr>
<td>vst.cpp</td>
<td>VST plugin</td>
<td></td>
</tr>
<tr>
<td>vst2p4.cpp</td>
<td>VST 2.4 plugin</td>
<td></td>
</tr>
<tr>
<td>vsti-mono.cpp</td>
<td>VSTi mono instrument</td>
<td></td>
</tr>
<tr>
<td>vsti-poly.cpp</td>
<td>VSTi polyphonic instrument</td>
<td></td>
</tr>
<tr>
<td>ladspa.cpp</td>
<td>LADSPA plugin</td>
<td></td>
</tr>
<tr>
<td>q.cpp</td>
<td>Q language plugin</td>
<td></td>
</tr>
<tr>
<td>supercollider.cpp</td>
<td>SuperCollider Unit Generator</td>
<td></td>
</tr>
<tr>
<td>snd-rt-gtk.cpp</td>
<td>Snd-RT music programming language</td>
<td></td>
</tr>
<tr>
<td>csound.cpp</td>
<td>CSOUND opcode</td>
<td></td>
</tr>
<tr>
<td>puredata.cpp</td>
<td>PD external</td>
<td></td>
</tr>
<tr>
<td>sndfile.cpp</td>
<td>sound file transformation command</td>
<td></td>
</tr>
<tr>
<td>bench.cpp</td>
<td>speed benchmark</td>
<td></td>
</tr>
<tr>
<td>octave.cpp</td>
<td>Octave plugin</td>
<td></td>
</tr>
<tr>
<td>plot.cpp</td>
<td>Command line application</td>
<td></td>
</tr>
<tr>
<td>sndfile.cpp</td>
<td>Command line application</td>
<td></td>
</tr>
<tr>
<td><a name="tab:availablearch"></a></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><span class='caption'>Some of the available architectures.</span></p>
<p>The main available architecture files are listed table <a href="../6-audio#tab:availablearch">tab:availablearch</a>. Since <span class="smallcaps">Faust</span> 0.9.40 some of these architectures are a modular combination of an <strong>audio module</strong> and one or more <strong>user interface modules</strong>. Among these user interface modules OSCUI provide supports for Open Sound Control allowing <span class="smallcaps">Faust</span> programs to be controlled by OSC messages. </p>
<h2 id="audio-architecture-modules">Audio architecture modules</h2>
<p>An <strong>audio architecture module</strong> typically connects a <span class="smallcaps">Faust</span> program to the audio drivers.
It is responsible for allocating and releasing the audio channels and for calling the <span class="smallcaps">Faust</span> <span class="lstinline">dsp::compute</span> method to handle incoming audio buffers and/or to produce audio output. It is also responsible for presenting the audio as non-interleaved float data, normalized between -1.0 and 1.0.</p>
<p>A <span class="smallcaps">Faust</span> audio architecture module derives an <strong>audio</strong> class defined as below:</p>
<pre><code>class audio {
 public:
           audio() {}
  virtual ~audio() {}
  virtual bool init(const char*, dsp*) = 0;
  virtual bool start() = 0;
  virtual void stop() = 0;
  virtual void shutdown(shutdown_callback cb, void* arg)  {}
  virtual int getBufferSize() = 0;
  virtual int getSampleRate() = 0;

  virtual int getNumInputs() = 0;
  virtual int getNumOutputs() = 0;

  virtual float getCPULoad() { return 0.f; }
};
</code></pre>
<p>The API is simple enough to give a great flexibility to audio architectures implementations. The <span class="lstinline">init</span> method should initialize the audio. At <span class="lstinline">init</span> exit, the system should be in a safe state to recall the <span class="lstinline">dsp</span> object state.</p>
<p>Table <a href="../6-audio#tab:aarch">tab:aarch</a> gives some of the audio architectures currently available for various operating systems.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Audio system</strong></td>
<td align="center"><strong>Operating system</strong></td>
</tr>
<tr>
<td align="center">Alsa</td>
<td align="center">Linux</td>
</tr>
<tr>
<td align="center">CoreAudio</td>
<td align="center">Mac OS X, iOS</td>
</tr>
<tr>
<td align="center">JACK</td>
<td align="center">Linux, Mac OS X, Windows</td>
</tr>
<tr>
<td align="center">PortAudio</td>
<td align="center">Linux, Mac OS X, Windows</td>
</tr>
<tr>
<td align="center">OSC</td>
<td align="center">Linux, Mac OS X, Windows</td>
</tr>
<tr>
<td align="center">VST</td>
<td align="center">Mac OS X, Windows</td>
</tr>
<tr>
<td align="center">Max/MSP</td>
<td align="center">Mac OS X, Windows</td>
</tr>
<tr>
<td align="center">Csound</td>
<td align="center">Linux, Mac OS X, Windows</td>
</tr>
<tr>
<td align="center">SuperCollider</td>
<td align="center">Linux, Mac OS X, Windows</td>
</tr>
<tr>
<td align="center">PureData</td>
<td align="center">Linux, Mac OS X, Windows</td>
</tr>
<tr>
<td align="center">Pure</td>
<td align="center">Linux, Mac OS X, Windows</td>
</tr>
<tr>
<td align="center"><a name="tab:aarch"></a></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p><span class='caption'>Some of <span class="smallcaps">Faust</span> audio architectures.</span></p>
<h2 id="ui-architecture-modules">UI architecture modules</h2>
<p><a name="gui"></a></p>
<p>A UI architecture module links user actions (via graphic widgets, command line parameters, OSC messages, etc.) with the <span class="smallcaps">Faust</span> program to control. 
It is responsible for associating program parameters to user interface elements and to update parameter's values according to user actions. This association is triggered by the <span class="lstinline">dsp::buildUserInterface</span> call, where the <span class="lstinline">dsp</span> asks a UI object to build the DSP module controllers.</p>
<p>Since the interface is basically graphic oriented, the main concepts are <strong>widget</strong> based: a UI architecture module is semantically oriented to handle active widgets, passive widgets and widgets layout.</p>
<p>A <span class="smallcaps">Faust</span> UI architecture module derives an <strong>UI</strong> class (Figure <a href="../6-audio#tab:ui">tab:ui</a>). </p>
<pre><code>
#ifndef FAUSTFLOAT
#define FAUSTFLOAT float
#endif

class UI
{
 public:
           UI() {}
  virtual ~UI() {}

     -- widget layouts
  virtual void openTabBox(const char* l)  = 0;
  virtual void openHorizontalBox(const char* l) = 0;
  virtual void openVerticalBox(const char* l) = 0;
  virtual void closeBox() = 0;

   -- active widgets
  virtual void addButton(const char* l, FAUSTFLOAT* z)      
     = 0;
  virtual void addCheckButton(const char* l, FAUSTFLOAT* z) 
     = 0;

  virtual void addVerticalSlider(const char* l,
          FAUSTFLOAT* z, 
          FAUSTFLOAT init, FAUSTFLOAT min, 
          FAUSTFLOAT max, FAUSTFLOAT step) = 0;

  virtual void addHorizontalSlider(const char* l, 
          FAUSTFLOAT* z, 
          FAUSTFLOAT init, FAUSTFLOAT min,
          FAUSTFLOAT max, FAUSTFLOAT step) = 0;

  virtual void addNumEntry(const char* l, FAUSTFLOAT* z, 
          FAUSTFLOAT init, FAUSTFLOAT min,
          FAUSTFLOAT max, FAUSTFLOAT step)  = 0;

   -- passive widgets
  virtual void addHorizontalBargraph(const char* l,
                        FAUSTFLOAT* z, FAUSTFLOAT min, 
                        FAUSTFLOAT max) = 0;

  virtual void addVerticalBargraph(const char* l, 
                        FAUSTFLOAT* z, FAUSTFLOAT min, 
                        FAUSTFLOAT max) = 0; 

   -- metadata declarations
  virtual void declare(FAUSTFLOAT*, const char*, const char*) {}
};
</code></pre>
<p><a name="tab:ui"></a>
<span class='caption'>UI, the root user interface class</span></p>
<h3 id="active-widgets">Active widgets</h3>
<p><a name="awidget"></a>
Active widgets are graphical elements that control a parameter value. They are initialized with the widget name and a pointer to the linked value, using the FAUSTFLOAT macro type (defined at compile time as either float or double).
The widget currently considered are <span class="lstinline">Button</span>,  <span class="lstinline">CheckButton</span>,  <span class="lstinline">VerticalSlider</span>,  <span class="lstinline">HorizontalSlider</span> and  <span class="lstinline">NumEntry</span>. 
A GUI architecture must implement a method 
<span class="lstinline">addXxx(const char<em> name, FAUSTFLOAT</em> zone, ...)</span> for each active widget.
Additional parameters are available for <span class="lstinline">Slider</span> and <span class="lstinline">NumEntry</span>: the <span class="lstinline">init</span>,  <span class="lstinline">min</span>,  <span class="lstinline">max</span> and <span class="lstinline">step</span> values.</p>
<h3 id="passive-widgets">Passive widgets</h3>
<p><a name="pwidget"></a>
Passive widgets are graphical elements that reflect values. Similarly to active widgets, they are initialized with the widget name and a pointer to the linked value.
The widget currently considered are  <span class="lstinline">HorizontalBarGraph</span> and  <span class="lstinline">VerticalBarGraph</span>. 
A UI architecture must implement a method 
<span class="lstinline">addXxx(const char<em> name, FAUSTFLOAT</em> zone, ...)</span> for each passive widget.
Additional parameters are available, depending on the passive widget type.</p>
<h3 id="widgets-layout">Widgets layout</h3>
<p><a name="wlayout"></a>
Generally, a  GUI is hierarchically organized into boxes and/or tab boxes. 
A UI architecture must support the following methods to setup this hierarchy : 
  <span class="lstinline">openTabBox(const char<em> label)</span> 
  <span class="lstinline">openHorizontalBox(const char</em> label)</span> 
  <span class="lstinline">openVerticalBox(const char<em> label)</span> 
  <span class="lstinline">closeBox(const char</em> label)</span> 
Note that all the widgets are added to the current box.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>UI</strong></td>
<td><strong>Comment</strong></td>
</tr>
<tr>
<td align="center">console</td>
<td>a textual command line UI</td>
</tr>
<tr>
<td align="center">GTKUI</td>
<td>a GTK-based GUI</td>
</tr>
<tr>
<td align="center">QTGUI</td>
<td>a multi-platform QT-based GUI</td>
</tr>
<tr>
<td align="center">FUI</td>
<td>a file-based UI to store and recall modules states</td>
</tr>
<tr>
<td align="center">OSCUI</td>
<td>OSC control (see section <a href="../7-osc#osc">osc</a>)</td>
</tr>
<tr>
<td align="center">httpdUI</td>
<td>HTTP control (see section <a href="../8-http#http">http</a>)</td>
</tr>
<tr>
<td align="center">...</td>
<td>...</td>
</tr>
<tr>
<td align="center"><a name="tab:uiarch"></a></td>
<td></td>
</tr>
</tbody>
</table>
<p><span class='caption'>Some of the available UI architectures.</span></p>
<h3 id="metadata">Metadata</h3>
<p><a name="metadata"></a>
The <span class="smallcaps">Faust</span> language allows widget labels to contain metadata enclosed in square brackets as key/value pairs. These metadata are handled at GUI level by a <span class="lstinline">declare</span> method taking as argument, a pointer to the widget associated zone, the metadata key and value: 
  <span class="lstinline">declare(FAUSTFLOAT<em> zone, const char</em> key, const char* value)</span> </p>
<p>Here is the table of currently supported general medatada (look at section <a href="../7-osc#osc">osc</a> for OSC specific metadata and section <a href="../9-midi#midi">midi</a> for MIDI specific metadata):</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Key</strong></td>
<td><strong>Value</strong></td>
</tr>
<tr>
<td align="center">tooltip</td>
<td>actual string content</td>
</tr>
<tr>
<td align="center">hidden</td>
<td><span class="lstinline">0</span> or <span class="lstinline">1</span></td>
</tr>
<tr>
<td align="center">size</td>
<td>actual value</td>
</tr>
<tr>
<td align="center">unit</td>
<td><span class="lstinline">Hz</span> or <span class="lstinline">dB</span></td>
</tr>
<tr>
<td align="center">scale</td>
<td><span class="lstinline">log</span> or <span class="lstinline">exp</span></td>
</tr>
<tr>
<td align="center">style</td>
<td><span class="lstinline">knob</span> or <span class="lstinline">led</span> or <span class="lstinline">numerical</span></td>
</tr>
<tr>
<td align="center">style</td>
<td><span class="lstinline">radio{\'label1\':v1;\'label2\':v2...</span>}</td>
</tr>
<tr>
<td align="center">style</td>
<td><span class="lstinline">menu{\'label1\':v1;\'label2\':v2...</span>}</td>
</tr>
<tr>
<td align="center">acc</td>
<td><span class="lstinline">axe curve amin amid amax</span></td>
</tr>
<tr>
<td align="center">gyr</td>
<td><span class="lstinline">axe curve amin amid amax</span></td>
</tr>
<tr>
<td align="center">screencolor</td>
<td><span class="lstinline">red</span> or <span class="lstinline">green</span>  or <span class="lstinline">blue</span> or <span class="lstinline">white</span></td>
</tr>
<tr>
<td align="center"><a name="tab:metadata"></a></td>
<td></td>
</tr>
</tbody>
</table>
<p><span class='caption'>Supported medatada.</span></p>
<p>Some typical example where several metadata are defined could be: </p>
<p><span class="lstinline">nentry("freq [unit:Hz][scale:log][acc:0 0 -30 0 30][style:menu{\'white noise\':0;\'pink noise\':1;\'sine\':2</span>][hidden:0]", 0, 20, 100, 1)} </p>
<p>or: </p>
<p><span class="lstinline">vslider("freq [unit:dB][style:knob][gyr:0 0 -30 0 30]", 0, 20, 100, 1)</span> </p>
<p>Note that medatada are not supported in all architecture files. Some of them like (<span class="lstinline">acc</span> or <span class="lstinline">gyr</span> for exemple) only make sense on platforms with accelerometers or gyroscopes sensors. The set of medatada may be extended in the future. </p>
<h2 id="developing-a-new-architecture-file">Developing a new architecture file</h2>
<p><a name="architecture"></a></p>
<p>Developing a new architecture file typically means writing a generic C++ file, that will be populated with the actual output of the <span class="smallcaps">Faust</span> compiler, in order to produce a complete C++ file, ready to be compiled as a standalone application or plugin. </p>
<p>The architecture to be used is specified at compile time with the <span class="lstinline">-a</span> option. It must contain the <span class="lstinline">&lt;<includeIntrinsic>&gt;</span> and <span class="lstinline">&lt;<includeclass>&gt;</span> lines that will be looked at by the <span class="smallcaps">Faust</span> compiler, and replaced by the generated C++ class. </p>
<p>Look at the <span class="lstinline">minimal.cpp</span> example located in the architecture folder:</p>
<pre><code>#include &quot;faust/gui/PrintUI.h&quot;
#include &quot;faust/gui/meta.h&quot;
#include &quot;faust/audio/dummy-audio.h&quot;

using std::max;
using std::min;

//-------------------------------------------------
//  FAUST generated signal processor
//-------------------------------------------------

&lt;&lt;includeIntrinsic&gt;&gt;

&lt;&lt;includeclass&gt;&gt;

int main(int argc, char *argv[])
{
    mydsp DSP;
    PrintUI ui;

    // Activate the UI
    // (here that only prints the control paths)
    DSP.buildUserInterface(&amp;ui);

    // Allocate the audio driver to render 
    // 5 buffers of 512 frames
    dummyaudio audio(5);
    audio.init(&quot;Test&quot;, &amp;DSP);

    // Render buffers...
    audio.start();

    audio.stop();
</code></pre>
<p>Calling <span class="lstinline">faust -a minimal.cpp noise.dsp -a noise.cpp</span> will produce a ready to compile  <span class="lstinline">noise.cpp</span> file:</p>
<pre><code>#include &quot;faust/gui/PrintUI.h&quot;
#include &quot;faust/gui/meta.h&quot;
#include &quot;faust/audio/dummy-audio.h&quot;

using std::max;
using std::min;

//---------------------------------------------------
//  FAUST generated signal processor
//--------------------------------------------------

#ifndef FAUSTFLOAT
#define FAUSTFLOAT float
#endif  

#ifndef FAUSTCLASS 
#define FAUSTCLASS mydsp
#endif

class mydsp : public dsp {
  private:
    FAUSTFLOAT fslider0;
    int iRec0[2];
    int fSamplingFreq;

  public:
    virtual void metadata(Meta* m) { 
        m-&gt;declare(&quot;name&quot;, &quot;Noise&quot;);
        m-&gt;declare(&quot;version&quot;, &quot;1.1&quot;);
        m-&gt;declare(&quot;author&quot;, &quot;Grame&quot;);
        m-&gt;declare(&quot;license&quot;, &quot;BSD&quot;);
        m-&gt;declare(&quot;copyright&quot;, &quot;(c)GRAME 2009&quot;);
    }

    virtual int getNumInputs() { return 0; }
    virtual int getNumOutputs() { return 1; }
    static void classInit(int samplingFreq) {
    }
    virtual void instanceConstants(int samplingFreq) {
        fSamplingFreq = samplingFreq;
    }
    virtual void instanceResetUserInterface() {
        fslider0 = 0.5f;
    }
    virtual void instanceClear() {
        for (int i=0; i&lt;2; i++) iRec0[i] = 0;
    }
    virtual void init(int samplingFreq) {
        classInit(samplingFreq);
        instanceInit(samplingFreq);
    }
    virtual void instanceInit(int samplingFreq) {
        instanceConstants(samplingFreq);
        instanceResetUserInterface();
        instanceClear();
    }
    virtual mydsp* clone() {
        return new mydsp();
    }
    virtual int getSampleRate() {
        return fSamplingFreq;
    }
    virtual void buildUserInterface(UI* ui_interface) {
        ui_interface-&gt;openVerticalBox(&quot;Noise&quot;);
        ui_interface-&gt;declare(&amp;fslider0, &quot;acc&quot;, &quot;0 0 -10 0 10&quot;);
        ui_interface-&gt;declare(&amp;fslider0, &quot;style&quot;, &quot;knob&quot;);
        ui_interface-&gt;addVerticalSlider(&quot;Volume&quot;, &amp;fslider0, 0.5f, 0.0f, 1.0f, 0.1f);
        ui_interface-&gt;closeBox();
    }
    virtual void compute (int count, FAUSTFLOAT** input, FAUSTFLOAT** output) {
        float fSlow0 = (4.656613e-10f * float(fslider0));
        FAUSTFLOAT* output0 = output[0];
        for (int i=0; i&lt;count; i++) {
            iRec0[0] = ((1103515245 * iRec0[1]) + 12345);
            output0[i] = (FAUSTFLOAT)(fSlow0 * iRec0[0]);
            // post processing
            iRec0[1] = iRec0[0];
        }
    }
};

int main(int argc, char* argv[])
{
    mydsp DSP;
    PrintUI ui;

    // Activate the UI
    // (here that only prints the control paths)
    DSP.buildUserInterface(&amp;ui);

    // Allocate the audio driver to render 
    // 5 buffers of 512 frames
    dummyaudio audio(5);
    audio.init(&quot;Test&quot;, &amp;DSP);

    // Render buffers...
    audio.start();

    audio.stop();
</code></pre>
<p>You can possibly add the <span class="lstinline">-i</span> option to actually inline all <span class="lstinline">#include "faust/xxx/yyy"</span> headers (all files starting with "faust"). Then you will have to write a <span class="lstinline">faust2xxx</span> script that will chain the <span class="smallcaps">Faust</span> compilation step and the C++ compilation one. Look at scripts in the tools/faust2appls folder for real examples. </p>
<p>Developing the adapted C++ file may require "aggregating" the generated <span class="lstinline">mydsp</span> class (subclass of <span class="lstinline">dsp</span> base class defined in faust/dsp/dsp.h header) in your specific class, or "subclassing" and extend it.  So you will have to write something like:</p>
<pre><code>class my_class : public base_interface {

  private:

    mydsp fDSP;

  public:

    my_class()
    {
        // Do something specific
    }

    virtual ~my_class()
    {
        // Do something specific
    }

    // Do something specific

    void my_compute(int count, 
        FAUSTFLOAT** inputs, 
        FAUSTFLOAT** outputs,....)
    {
        // Do something specific
        fDSP.compute(count,  inputs,  outputs);
    }

    // Do something specific
};

</code></pre>
<p>or:</p>
<pre><code>class my_class : public mydsp  {

  private:

    // Do something specific

  public:

    my_class()
    {
        // Do something specific
    }

    virtual ~my_class()
    {
        // Do something specific
    }

    // Do something specific

    void my_compute(int count, 
        FAUSTFLOAT** inputs, 
        FAUSTFLOAT** outputs,....)
    {
        // Do something specific
        compute(count,  inputs,  outputs);
    }

    // Do something specific
};
</code></pre>
<p>This way your architecture file will be adapted to any "shape" of the generated code. That is, depending if you generate purely scalar, or vector code (using the <span class="lstinline">-vec</span> option), or any other option, the generated <span class="lstinline">mydsp</span>  class will always be correctly inserted in the final C++ file. Look for instance at <span class="lstinline">csound.cpp</span> and <span class="lstinline">unity.cpp</span> architecture files in the architecture folder for real examples. </p></div>
        </div>
    </div>

    <footer class="col-md-12">
        <hr>
        <p>Copyright &copy; 2020-2024 <a href="https://www.grame.fr">Grame-CNCM</a></p>
    </footer>
    <script>
        var base_url = "../..",
        shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
    </script>
    <script src="../../js/base.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
    <script src="../../search/main.js" defer></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/@grame/faust-web-component@0.3.2/dist/faust-web-component.js"
        defer></script>
    </body>

</html>
