<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title> 2020-03-24 CITI  - Faust Documentation</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="/css/quickref.css" rel="stylesheet">
        <link href="/rail/railroad-diagrams.css" rel="stylesheet">

        <script src="../../js/jquery-3.6.0.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../.."><img src="../../img/faustText.svg" width="150px"> </a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Manual <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../manual/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../manual/overview/" class="dropdown-item">Overview of the Faust Universe</a>
</li>
                                    
<li>
    <a href="../../manual/quick-start/" class="dropdown-item">Quick Start</a>
</li>
                                    
<li>
    <a href="../../manual/syntax/" class="dropdown-item">Faust Syntax</a>
</li>
                                    
<li>
    <a href="../../manual/errors/" class="dropdown-item">Error Messages</a>
</li>
                                    
<li>
    <a href="../../manual/compiler/" class="dropdown-item">Using the Compiler</a>
</li>
                                    
<li>
    <a href="../../manual/options/" class="dropdown-item">Compiler Options</a>
</li>
                                    
<li>
    <a href="../../manual/tools/" class="dropdown-item">faust2[...] Tools</a>
</li>
                                    
<li>
    <a href="../../manual/architectures/" class="dropdown-item">Architecture Files</a>
</li>
                                    
<li>
    <a href="../../manual/embedding/" class="dropdown-item">Embedding the Compiler</a>
</li>
                                    
<li>
    <a href="../../manual/optimizing/" class="dropdown-item">Optimizing the Code</a>
</li>
                                    
<li>
    <a href="../../manual/debugging/" class="dropdown-item">Debugging the Code</a>
</li>
                                    
<li>
    <a href="../../manual/deploying/" class="dropdown-item">Deploying on the Web</a>
</li>
                                    
<li>
    <a href="../../manual/remote/" class="dropdown-item">Remote Compilation</a>
</li>
                                    
<li>
    <a href="../../manual/mathdoc/" class="dropdown-item">Mathematical Documentation</a>
</li>
                                    
<li>
    <a href="../../manual/osc/" class="dropdown-item">OSC Support</a>
</li>
                                    
<li>
    <a href="../../manual/http/" class="dropdown-item">HTTP Support</a>
</li>
                                    
<li>
    <a href="../../manual/midi/" class="dropdown-item">MIDI Support</a>
</li>
                                    
<li>
    <a href="../../manual/soundfiles/" class="dropdown-item">Soundfiles Support</a>
</li>
                                    
<li>
    <a href="../../manual/community/" class="dropdown-item">Community</a>
</li>
                                    
<li>
    <a href="../../manual/faq/" class="dropdown-item">Frequently Asked Questions</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../examples/ambisonics/" class="dropdown-item"> ambisonics </a>
</li>
                                    
<li>
    <a href="../../examples/analysis/" class="dropdown-item"> analysis </a>
</li>
                                    
<li>
    <a href="../../examples/bela/" class="dropdown-item"> bela </a>
</li>
                                    
<li>
    <a href="../../examples/delayEcho/" class="dropdown-item"> delayEcho </a>
</li>
                                    
<li>
    <a href="../../examples/dynamic/" class="dropdown-item"> dynamic </a>
</li>
                                    
<li>
    <a href="../../examples/filtering/" class="dropdown-item"> filtering </a>
</li>
                                    
<li>
    <a href="../../examples/gameaudio/" class="dropdown-item"> gameaudio </a>
</li>
                                    
<li>
    <a href="../../examples/generator/" class="dropdown-item"> generator </a>
</li>
                                    
<li>
    <a href="../../examples/misc/" class="dropdown-item"> misc </a>
</li>
                                    
<li>
    <a href="../../examples/phasing/" class="dropdown-item"> phasing </a>
</li>
                                    
<li>
    <a href="../../examples/physicalModeling/" class="dropdown-item"> physicalModeling </a>
</li>
                                    
<li>
    <a href="../../examples/pitchShifting/" class="dropdown-item"> pitchShifting </a>
</li>
                                    
<li>
    <a href="../../examples/psychoacoustic/" class="dropdown-item"> psychoacoustic </a>
</li>
                                    
<li>
    <a href="../../examples/reverb/" class="dropdown-item"> reverb </a>
</li>
                                    
<li>
    <a href="../../examples/SAM/" class="dropdown-item"> SAM </a>
</li>
                                    
<li>
    <a href="../../examples/smartKeyboard/" class="dropdown-item"> smartKeyboard </a>
</li>
                                    
<li>
    <a href="../../examples/spat/" class="dropdown-item"> spat </a>
</li>
                                    
<li>
    <a href="../../rsrc/examples.zip" class="dropdown-item"> Download examples </a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2020-04-10-faust-juce/" class="dropdown-item">Faust & JUCE</a>
</li>
                                    
<li>
    <a href="../../tutorials/teensy/" class="dropdown-item">DSP on the Teensy With Faust</a>
</li>
                                    
<li>
    <a href="../../tutorials/esp32/" class="dropdown-item">DSP on the ESP-32 With Faust</a>
</li>
                                    
<li>
    <a href="../../tutorials/basic-osc/" class="dropdown-item">Making a Sine Oscillator From Scratch</a>
</li>
                                    
<li>
    <a href="../../tutorials/summation/" class="dropdown-item">RMS and Summation in Faust</a>
</li>
                                    
<li>
    <a href="../../tutorials/box-api/" class="dropdown-item">Using the box API</a>
</li>
                                    
<li>
    <a href="../../tutorials/signal-api/" class="dropdown-item">Using the signal API</a>
</li>
                                    
<li>
    <a href="../../tutorials/julia/" class="dropdown-item">Using Faust in Julia</a>
</li>
                                    
<li>
    <a href="../../tutorials/cmajor/" class="dropdown-item">Using Faust in Cmajor</a>
</li>
                                    
<li>
    <a href="../../tutorials/jsfx/" class="dropdown-item">Using Faust in JSFX</a>
</li>
                                    
<li>
    <a href="../../tutorials/rnbo/" class="dropdown-item">Using Faust in RNBO with codebox~</a>
</li>
                                    
<li>
    <a href="../../tutorials/debugging/" class="dropdown-item">Advanced debugging with interp-tracer</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Workshops <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2018-12-01-paw/" class="dropdown-item"> 2018-12-01 PAW </a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active"> 2020-03-24 CITI </a>
</li>
                                    
<li>
    <a href="../2020-04-10-faust-101/" class="dropdown-item"> 2020-04-10 Faust 101 </a>
</li>
                                    
<li>
    <a href="../2020-04-10-faust-juce/" class="dropdown-item"> 2020-04-10 Faust & JUCE </a>
</li>
                                    
<li>
    <a href="../2020-11-21-faust-vcvrack/" class="dropdown-item"> 2020-11-21 Faust & VCV Rack </a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        

        <div class="container">
            <div class="row"><div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#faust-workshop-at-citi" class="nav-link">Faust workshop at CITI</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#signal-en-dent-de-scie" class="nav-link">Signal en dent de scie</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#generateur-de-phase" class="nav-link">Générateur de Phase</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#rampe" class="nav-link">Rampe</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#semantique" class="nav-link">Sémantique</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#signal-de-phase" class="nav-link">Signal de phase</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#generateur-de-signal-en-dent-de-scie" class="nav-link">Generateur de signal en dent de scie</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#generateur-de-signal-carre" class="nav-link">Generateur de signal carré</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#synthese-additive" class="nav-link">Synthèse additive</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#exemple-1-generateur-sinusoidal" class="nav-link">Exemple 1 : générateur sinusoidal</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-2-une-onde-sinusoidale-avec-controle-de-volume" class="nav-link">Exemple 2 : une onde sinusoidale avec controle de volume</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-3-exercice-ajouter-un-controle-de-frequence" class="nav-link">Exemple 3 : Exercice, ajouter un contrôle de fréquence</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-4-phenomene-de-repliement-de-frequence-au-dela-de-sr2" class="nav-link">Exemple 4 : Phénomène de repliement de fréquence au-delà de SR/2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-5-synthese-additive" class="nav-link">Exemple 5 : Synthèse additive</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-6-approximation-dun-signal-carre-par-synthese-additive" class="nav-link">Exemple 6 : Approximation d'un signal carré par synthèse additive</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-7-approximation-dun-signal-en-dent-de-scie-par-synthese-additive" class="nav-link">Exemple 7 : Approximation d'un signal en dent de scie par synthèse additive</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#synthese-soustractive" class="nav-link">Synthèse soustractive</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#exemple-1-un-bruit-blanc" class="nav-link">Exemple 1 : un bruit blanc</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-2-lowpass" class="nav-link">Exemple 2 : lowpass</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-3-high-pass" class="nav-link">Exemple 3 : high pass</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-4-bandpass" class="nav-link">Exemple 4 : bandpass</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-5-resonnant" class="nav-link">Exemple 5 : resonnant</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-6-fir" class="nav-link">Exemple 6 : fir</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-7-iir" class="nav-link">Exemple 7 : iir</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-8-filtre-en-peigne" class="nav-link">Exemple 8 : filtre en peigne</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-9-karplus-strong-12" class="nav-link">Exemple 9 : Karplus Strong (1/2)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-10-karplus-strong-22" class="nav-link">Exemple 10 : Karplus Strong (2/2)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-11-kisana" class="nav-link">Exemple 11 : Kisana</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#synthese-par-modulation-de-frequence" class="nav-link">Synthèse par modulation de fréquence</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#exemple-1-fm1" class="nav-link">Exemple 1 : fm1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#exemple-2-fm2" class="nav-link">Exemple 2 : fm2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9 main-container" role="main">

<h1 id="faust-workshop-at-citi">Faust workshop at CITI</h1>
<p>L'objectif de ce workshop est de se familiariser avec le langage Faust à travers des exemples simples de synthèse sonore. Tous les exemples seront executé dans l'IDE Faust en ligne <a href="https://faustide.grame.fr">https://faustide.grame.fr</a>. Si jamais les sons produits avec l'IDE sont de mauvaise qualité, avec des clics, on peut utiliser l'éditeur en ligne, plus rustique, mais aussi plus léger <a href="https://fausteditor.grame.fr">https://fausteditor.grame.fr</a></p>
<h2 id="signal-en-dent-de-scie">Signal en dent de scie</h2>
<p>Par convention, en Faust, un signal audio à pleine échelle varie entre -1 et +1. Mais dans un premier temps nous allons commencer par un signal en dent de scie entre 0 et 1 qui nous servira par la suite de <em>générateur de phase</em> pour produire différentes formes d'onde.</p>
<h3 id="generateur-de-phase">Générateur de Phase</h3>
<p>La première étape consiste à construire un <em>générateur de phase</em> qui produit un signal périodique en dents de scie entre 0 et 1. Voici le signal que nous voulons générer :</p>
<p><img src="img/phase-sig.png" width="70%" class="mx-auto d-block"></p>
<h3 id="rampe">Rampe</h3>
<p>Pour cela nous allons produire une rampe "infinie", que nous transformerons ensuite en un signal périodique grâce à une opération <em>partie-decimale</em> :</p>
<p><img src="img/ramp-sig.png" width="70%" class="mx-auto d-block"></p>
<p>La rampe est produite par le programme suivant :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust0/exfaust0.svg" class="mx-auto d-block">
<faust-editor><!--

process = 0.125 : + ~ _;

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="semantique">Sémantique</h3>
<p>Dans l'exemple précédent, <code>0,125</code>, <code>+</code> et <code>_</code> sont des <em>primitives</em> du langage. Les deux autres signes : <code>:</code> et <code>~</code> sont des opérateurs de cablage. Ils sont utilisés pour relier entre elles les expressions du langage.</p>
<p>Pour comprendre le diagramme ci-dessus, nous allons l'annoter avec sa sémantique mathématique :</p>
<p><img src="img/ramp-diag-math.svg" width="60%" class="mx-auto d-block"></p>
<p>Comme on peut le voir dans le diagramme, la formule du signal de sortie est : <script type="math/tex">y(t) = y(t-1) + 0.125</script>
</p>
<p>On peut calculer les premières valeurs de <script type="math/tex">y(t)</script> :</p>
<ul>
<li>
<script type="math/tex">y(t<0)=0</script>
</li>
<li>
<script type="math/tex">y(0) = y(-1) + 0.125 = 0.125</script>
</li>
<li>
<script type="math/tex">y(1) = y(0) + 0.125 = 2*0.125 = 0.250</script>
</li>
<li>
<script type="math/tex">y(2) = y(1) + 0.125 = 3*0.125 = 0.375</script>
</li>
<li>...</li>
<li>
<script type="math/tex">y(6) = y(5) + 0.125 = 7*0.125 = 0.875</script>
</li>
<li>
<script type="math/tex">y(7) = y(6) + 0.125 = 8*0.125 = 1.000</script>
</li>
<li>
<script type="math/tex">y(8) = y(7) + 0.125 = 9*0.125 = 1.125</script>
</li>
<li>...</li>
</ul>
<h3 id="signal-de-phase">Signal de phase</h3>
<p>Comment transformer la rampe ci-dessus en signal en dents de scie ? En supprimant la partie entière des échantillons afin de ne garder que la partie décimale (fractionnaire) (<code>3.14159</code> -&gt; <code>0.14159</code>).</p>
<p>Définissons une fonction pour faire cela :</p>
<pre><code>decimalpart(x) = x - int(x);
</code></pre>
<p>Nous pouvons maintenant utiliser cette fonction pour transformer notre rampe en dents de scie. Il est alors tentant d'écrire :</p>
<pre><code>process = 0.125 : + ~ _ : decimalpart;
</code></pre>
<p>D'un point de vue mathématique, ce serait parfaitement correct, mais nous allons accumuler les erreurs d'arrondi. Pour conserver une précision totale, il est préférable de placer l'opération de la partie décimale à l'intérieur de la boucle comme ceci :</p>
<pre><code>process = 0.125 : (+ : decimalpart) ~ _;
</code></pre>
<p>On peut maintenant essayer l'ensemble du code (<strong>pensez à baisser le volume</strong>) :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust1/exfaust1.svg" class="mx-auto d-block">
<faust-editor><!--

decimalpart(x) = x-int(x);
phase = 0.125 : (+ : decimalpart) ~ _;
process = phase;

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<p>Dans notre définition de la <code>phase</code>, la valeur du pas, ici <code>0,125</code>, contrôle la fréquence du signal généré. Nous aimerions calculer cette valeur de pas en fonction de la fréquence souhaitée. Afin de faire la conversion, nous devons connaître la fréquence d'échantillonnage. Elle est disponible dans la bibliothèque standard sous le nom de <code>ma.SR</code>. Pour utiliser cette bibliothèque standard nous ajoutons au programme la ligne suivante : <code>import("stdfaust.lib");</code></p>
<p>Supposons que nous voulions que notre signal de phase ait une fréquence de 1 Hz, alors le pas devrait être très petit <code>1/ma.SR</code>, afin qu'il faille  <code>ma.SR</code> échantillons (c'est à dire 1 seconde) pour que le signal de phase passe de 0 à 1.</p>
<p>Si nous voulons une fréquence de 440 Hz, nous avons besoin d'un pas 440 fois plus grand pour que le signal de phase passe de 0 à 1 440 fois plus vite :</p>
<pre><code>phase = 440/ma.SR : (+ : decimalpart) ~ _;
</code></pre>
<p>On peut généraliser cette définition en remplaçant <code>440</code> par un paramètre <code>f</code>:</p>
<pre><code>phase(f) = f/ma.SR : (+ : decimalpart) ~ _;
</code></pre>
<p>et en passant la fréquence souhaitée à <code>phase</code>:</p>
<pre><code>process = phase(440);
</code></pre>
<h3 id="generateur-de-signal-en-dent-de-scie">Generateur de signal en dent de scie</h3>
<p>Nous pouvons maintenant nous servir du générateur de phase pour produire un signal en dent de scie :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust2/exfaust2.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

decimalpart(x) = x-int(x);
phase(f) = f/ma.SR : (+ : decimalpart) ~ _;

sawtooth(f) = phase(f) * 2 - 1;

process = sawtooth(440);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="generateur-de-signal-carre">Generateur de signal carré</h3>
<p>Nous pouvons également nous servir du générateurr de phase pour produire un signal carré :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust3/exfaust3.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

decimalpart(x) = x-int(x);
phase(f) = f/ma.SR : (+ : decimalpart) ~ _;

squarewave(f) = (phase(f) > 0.5) * 2 - 1;

process = squarewave(440);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h2 id="synthese-additive">Synthèse additive</h2>
<h3 id="exemple-1-generateur-sinusoidal">Exemple 1 : générateur sinusoidal</h3>
<p>Le générateur de phase est également à la base de l'oscillateur sinusoidal :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust4/exfaust4.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

decimalpart(x) = x-int(x);
phase(f) = f/ma.SR : (+ : decimalpart) ~ _;

osc(f) = sin(phase(f) * 2 * ma.PI);

process = osc(440);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<p>Mais maintenant que nous avons vu comment créer de toutes pièces un oscillateur sinusoidal, nous allons utiliser celui qui est défini dans la libraries standard de Faust :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust5/exfaust5.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = os.osc(440);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-2-une-onde-sinusoidale-avec-controle-de-volume">Exemple 2 : une onde sinusoidale avec controle de volume</h3>
<p>Dans ce deuxième exemple on a utilisé un slider horizontal <code>hslider(...)</code> pour régler le niveau sonore :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust6/exfaust6.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = os.osc(440) * hslider("gain", 0.1, 0, 1, 0.01);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<p>Le premier paramètre est une chaine de caractère qui indique le nom du slider. Il est suivi de quatre paramètres numériques. Le deuxième paramètre <code>0.1</code> indique la valeur par défaut du slider, c'est à dire la valeur que va délivrer le slider quand on lance le programme. Ensuite nous avons la valeur minimale <code>0</code>, la valeur maximale <code>1</code> et le pas de variation <code>0.01</code>.</p>
<h3 id="exemple-3-exercice-ajouter-un-controle-de-frequence">Exemple 3 : Exercice, ajouter un contrôle de fréquence</h3>
<p>A titre d'exercice, remplacer, dans l'exemple précédent, la fréquence 440 par un slider horizontal dont le nom sera <code>"freq"</code>, la valeur par défaut <code>110</code>, la valeur minimale <code>40</code>, la valeur maximale <code>8000</code> et le pas <code>1</code>.</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust7/exfaust7.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = os.osc(440 /*a remplacer*/) * hslider("gain", 0.1, 0, 1, 0.01);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-4-phenomene-de-repliement-de-frequence-au-dela-de-sr2">Exemple 4 : Phénomène de repliement de fréquence au-delà de SR/2</h3>
<p>Un problème bien connu dans le domaine de la synthèse numérique du son est celui du repliement de fréquence : toute fréquence au dela de la moitié de la fréquence d'échatillonnage se retrouve <em>repliée</em> dans le spectre audible : </p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust8/exfaust8.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// A frequency aliasing phenomenon if one goes beyond SR/2

process = os.osc(hslider("freq", 440, 20, 20000, 1)) * hslider("gain", 0.1, 0, 1, 0.01);


--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-5-synthese-additive">Exemple 5 : Synthèse additive</h3>
<p>Un exemple de synthèse additive ou le niveau de chaque partiel peut être réglé individuellement : </p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust9/exfaust9.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

//----------------------------------------------------------------------
// partial(f,n);
// f = frequence en Hz
// n = numero du partiel en partant de 1
partial(n,f) = os.osc(f*n) * hslider("partial %n", 0.25, 0, 1, 0.01);

process = sum(i, 4, partial(i+1,hslider("freq", 440, 20, 8000, 0.001)));

--></faust-editor>
<br>
</div>
<!-- /faust-run -->
<p>A noter l'utilisation de la construction <code>sum(i, n, foo(i))</code> qui est equivalente à <code>foo(0)+foo(1)+...+foo(n-1)</code>.</p>
<h3 id="exemple-6-approximation-dun-signal-carre-par-synthese-additive">Exemple 6 : Approximation d'un signal carré par synthèse additive</h3>
<p>Nous avons vu précédemment comment produire une signal carré parfait. Ce signal carré parfait comporte une infinité d'harmoniques qui, du fait de l'échantillonnage, vont se replier sur le spectre audible, ce qui va donner un son bruité moins fidèle ! On peut approximer un signal carré par synthèse additive, en additionnant une serie infinie d'harmoniques impaires (voir <a href="https://fr.wikipedia.org/wiki/Signal_carré">https://fr.wikipedia.org/wiki/Signal_carré</a>) :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust10/exfaust10.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// Approximation of a square wave using additive synthesis

squarewave(f) = 4/ma.PI*sum(k, 4, os.osc((2*k+1)*f)/(2*k+1));

process = squarewave(55);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->
<p>A titre d'excercice, faire varier le nombre d'harmoniques pour voir l'approximation s'améliorer (mais sans dépasser SR/2).</p>
<h3 id="exemple-7-approximation-dun-signal-en-dent-de-scie-par-synthese-additive">Exemple 7 : Approximation d'un signal en dent de scie par synthèse additive</h3>
<p>De même on peut approximer un signal en dent de scie par synthèse additive, en additionnant une serie infinie d'harmoniques (voir <a href="https://fr.wikipedia.org/wiki/Signal_en_dents_de_scie">https://fr.wikipedia.org/wiki/Signal_en_dents_de_scie</a>) :</p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust11/exfaust11.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// Approximation of a sawtooth wave using additive synthesis

sawtooth(f) = 2/ma.PI*sum(k, 4, (-1)^k * os.osc((k+1)*f)/(k+1));

process = sawtooth(55);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h2 id="synthese-soustractive">Synthèse soustractive</h2>
<p>La synthèse soustractive procède à l'inverse de la synthèse additive. Elle consiste à partir d'un son riche, par exemple un bruit blanc, et à sculpter son spectre.</p>
<h3 id="exemple-1-un-bruit-blanc">Exemple 1 : un bruit blanc</h3>
<p>Un bruit blanc : </p>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust12/exfaust12.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = no.noise * hslider("noise", 0.5, 0, 1, 0.01);

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-2-lowpass">Exemple 2 : lowpass</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust13/exfaust13.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) : fi.lowpass(3, hslider("hifreq", 2000, 20, 20000, 1));


--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-3-high-pass">Exemple 3 : high pass</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust14/exfaust14.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) : fi.highpass(3, hslider("lowfreq", 400, 20, 20000, 1));


--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-4-bandpass">Exemple 4 : bandpass</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust15/exfaust15.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) 
: fi.highpass(3, hslider("lowfreq", 400, 20, 20000, 1))
: fi.lowpass(3, hslider("hifreq", 2000, 20, 20000, 1));


--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-5-resonnant">Exemple 5 : resonnant</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust16/exfaust16.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) 
        : fi.resonlp(hslider("hifreq", 400, 20, 20000, 1),
                    hslider("Q", 1, 1, 100, 0.01),
                    hslider("gain", 1, 0, 2, 0.01));

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-6-fir">Exemple 6 : fir</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust17/exfaust17.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// FIR
process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) 
        <: _,transformation :> _;

transformation = @(1) : *(hslider("gain", 0, -1, 1, 0.1));

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-7-iir">Exemple 7 : iir</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust18/exfaust18.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// IIR
process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) :
        + ~ transformation;

transformation = @(0) : *(hslider("gain", 0, -0.95, 0.95, 0.01));

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-8-filtre-en-peigne">Exemple 8 : filtre en peigne</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust19/exfaust19.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// IIR, Filtre en peigne
process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) :
        + ~ transformation;

transformation = @(hslider("delay", 0, 0, 20, 1)) : *(hslider("gain", 0, -0.98, 0.98, 0.01));

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-9-karplus-strong-12">Exemple 9 : Karplus Strong (1/2)</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust20/exfaust20.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// Karplus Strong (1/2)
process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) :
        + ~ transformation;

transformation = @(hslider("delay", 0, 0, 200, 1)) : moyenne : *(hslider("gain", 0, -0.98, 0.98, 0.01));

moyenne(x) = (x+x')/2;

--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-10-karplus-strong-22">Exemple 10 : Karplus Strong (2/2)</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust21/exfaust21.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// Karplus Strong (2/2)
process = no.noise * hslider("noise", 0.5, 0, 1, 0.01) 
        : *(envelop)
        : + ~ transformation;

transformation = @(hslider("delay", 0, 0, 200, 1)) : moyenne : *(hslider("gain", 0, -0.999, 0.999, 0.001));

moyenne(x) = (x+x')/2;

envelop = button("gate") : upfront : en.ar(0.002, 0.01);

upfront(x) = x>x';


--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-11-kisana">Exemple 11 : Kisana</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust22/exfaust22.svg" class="mx-auto d-block">
<faust-editor><!--

declare name     "myKisana";
declare author  "Yann Orlarey";

//Modifications GRAME July 2015

/* ========= DESCRIPTION =============

- Kisana : 3-loops string instrument (based on Karplus-Strong)
- Head = Silence
- Tilt = High frequencies 
- Front = High + Medium frequencies
- Bottom = High + Medium + Low frequencies
- Left = Minimum brightness
- Right = Maximum birghtness
- Front = Long notes
- Back = Short notes

*/

import("stdfaust.lib");

KEY = 60;   // basic midi key
NCY = 15;   // note cycle length
CCY = 15;   // control cycle length
BPS = 360;  // general tempo (ba.beat per sec)

process = kisana;    

//-------------------------------kisana----------------------------------
// USAGE:  kisana : _,_;
//      3-loops string instrument
//-----------------------------------------------------------------------

kisana = vgroup("MyKisana", harpe(C,11,48), harpe(C,11,60), (harpe(C,11,72) : *(1.5), *(1.5)) 
    :> *(l), *(l))
    with {
        l = -20 : ba.db2linear;//hslider("[1]Volume",-20, -60, 0, 0.01) : ba.db2linear;
        C = hslider("[2]Brightness[acc:0 1 -10 0 10]", 0.2, 0, 1, 0.01) : ba.automat(BPS, CCY, 0.0);
    };

//----------------------------------Harpe--------------------------------
// USAGE:  harpe(C,10,60) : _,_;
//      C is the filter coefficient 0..1
//      Build a N (10) strings harpe using a pentatonic scale 
//      based on midi key b (60)
//      Each string is triggered by a specific
//      position of the "hand"
//-----------------------------------------------------------------------
harpe(C,N,b) = hand(b) <: par(i, N, position(i+1)
                        : string(C,Penta(b).degree2Hz(i), att, lvl)
                        : pan((i+0.5)/N) )
                        :> _,_
    with {
        att  = hslider("[3]Resonance[acc:2 1 -10 0 12]", 4, 0.1, 10, 0.01); 
        hand(48) = vslider("h:[1]Instrument Hands/1 (Note %b)[unit:pk]", 0, 0, N, 1) : int : ba.automat(120, CCY, 0.0);
        hand(60) = vslider("h:[1]Instrument Hands/2 (Note %b)[unit:pk]", 2, 0, N, 1) : int : ba.automat(240, CCY, 0.0);
        hand(72) = vslider("h:[1]Instrument Hands/3 (Note %b)[unit:pk]", 4, 0, N, 1) : int : ba.automat(480, CCY, 0.0);
        //lvl  = vslider("h:loop/level", 0, 0, 6, 1) : int : ba.automat(BPS, CCY, 0.0) : -(6) : ba.db2linear; 
        lvl = 1;
        pan(p) = _ <: *(sqrt(1-p)), *(sqrt(p));
        position(a,x) = abs(x - a) < 0.5;
    };

//----------------------------------Penta-------------------------------
// Pentatonic scale with degree to midi and degree to Hz conversion
// USAGE: Penta(60).degree2midi(3) ==> 67 midikey
//        Penta(60).degree2Hz(4)   ==> 440 Hz
//-----------------------------------------------------------------------

Penta(key) = environment {

    A4Hz = 440; 

    degree2midi(0) = key+0;
    degree2midi(1) = key+2;
    degree2midi(2) = key+4;
    degree2midi(3) = key+7;
    degree2midi(4) = key+9;
    degree2midi(d) = degree2midi(d-5)+12;

    degree2Hz(d) = A4Hz*semiton(degree2midi(d)-69) with { semiton(n) = 2.0^(n/12.0); };

}; 

//----------------------------------String-------------------------------
// A karplus-strong string.
//
// USAGE: string(440Hz, 4s, 1.0, button("play"))
// or     button("play") : string(440Hz, 4s, 1.0)
//-----------------------------------------------------------------------

string(coef, freq, t60, level, trig) = no.noise*level
                            : *(trig : trigger(freq2samples(freq)))
                            : resonator(freq2samples(freq), att)
    with {
        resonator(d,a)  = (+ : @(d-1)) ~ (average : *(a));
        average(x)      = (x*(1+coef)+x'*(1-coef))/2;
        trigger(n)      = upfront : + ~ decay(n) : >(0.0);
        upfront(x)      = (x-x') > 0.0;
        decay(n,x)      = x - (x>0.0)/n;
        freq2samples(f) = 44100.0/f;
        att             = pow(0.001,1.0/(freq*t60)); // attenuation coefficient
        random          = +(12345)~*(1103515245);
        noise           = random/2147483647.0;
    };


--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h2 id="synthese-par-modulation-de-frequence">Synthèse par modulation de fréquence</h2>
<h3 id="exemple-1-fm1">Exemple 1 : fm1</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust23/exfaust23.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// FM: Frequency moulation

FM(fc,fm,amp) = fm : os.osc : *(amp) : +(1) : *(fc) : os.osc;

process = FM( 
            hslider("freq carrier", 880, 40, 8000, 1),
            hslider("freq modulation", 200, 10, 1000, 1),
            hslider("amp modulation", 0, 0, 1, 0.01)
            ) 
        <: _,_;


--></faust-editor>
<br>
</div>
<!-- /faust-run -->

<h3 id="exemple-2-fm2">Exemple 2 : fm2</h3>
<!-- faust-run -->
<div class="faust-run"><img src="exfaust24/exfaust24.svg" class="mx-auto d-block">
<faust-editor><!--

import("stdfaust.lib");

// FM: Frequency moulation 2

FM(fc,fm,amp) = fm : os.osc : *(amp) : +(1) : *(fc) : os.osc;

process = FM( 
            hslider("freq carrier", 880, 40, 8000, 1),
            hslider("freq modulation", 200, 10, 1000, 1)*(2+envelop2)/3,
            hslider("amp modulation", 0, 0, 1, 0.01)*(0.5+envelop2)/1.5
            ) 
        : *(envelop1)
        <: dm.freeverb_demo;

envelop1 = button("gate") : upfront : en.ar(0.001, 1);
envelop2 = button("gate") : upfront : en.ar(0.5, 0.5);

upfront(x) = x>x';


--></faust-editor>
<br>
</div>
<!-- /faust-run --></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020-2024 <a href="https://www.grame.fr">Grame-CNCM</a></p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

        <script src="https://cdn.jsdelivr.net/npm/@grame/faust-web-component@0.2.25/dist/faust-web-component.js" defer></script>
    </body>
</html>
