<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <title>Embedding the Compiler - Faust Documentation
    </title>
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="/css/quickref.css" rel="stylesheet">
    <link href="/css/github.min.css" rel="stylesheet">
    <link href="/rail/railroad-diagrams.css" rel="stylesheet">
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <script src="../../js/bootstrap.min.js" defer></script>
    <script src="../../js/MathJax-2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"defer></script>
    <script src="../../js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
    <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="../.."><img
                    src="../../img/faustText.svg" width="150px"> </a>
            <!-- Expander button -->
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Expanded navigation -->
            <div id="navbar-collapse" class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li class="navitem">
                        <a href="../.." class="nav-link">Home</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Manual <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../introduction/" class="dropdown-item">Introduction</a>
</li>
                            
<li>
    <a href="../overview/" class="dropdown-item">Overview of the Faust Universe</a>
</li>
                            
<li>
    <a href="../quick-start/" class="dropdown-item">Quick Start</a>
</li>
                            
<li>
    <a href="../syntax/" class="dropdown-item">Faust Syntax</a>
</li>
                            
<li>
    <a href="../errors/" class="dropdown-item">Error Messages</a>
</li>
                            
<li>
    <a href="../compiler/" class="dropdown-item">Using the Compiler</a>
</li>
                            
<li>
    <a href="../options/" class="dropdown-item">Compiler Options</a>
</li>
                            
<li>
    <a href="../tools/" class="dropdown-item">faust2[...] Tools</a>
</li>
                            
<li>
    <a href="../architectures/" class="dropdown-item">Architecture Files</a>
</li>
                            
<li>
    <a href="./" class="dropdown-item active">Embedding the Compiler</a>
</li>
                            
<li>
    <a href="../optimizing/" class="dropdown-item">Optimizing the Code</a>
</li>
                            
<li>
    <a href="../debugging/" class="dropdown-item">Debugging the Code</a>
</li>
                            
<li>
    <a href="../deploying/" class="dropdown-item">Deploying on the Web</a>
</li>
                            
<li>
    <a href="../remote/" class="dropdown-item">Remote Compilation</a>
</li>
                            
<li>
    <a href="../mathdoc/" class="dropdown-item">Mathematical Documentation</a>
</li>
                            
<li>
    <a href="../osc/" class="dropdown-item">OSC Support</a>
</li>
                            
<li>
    <a href="../http/" class="dropdown-item">HTTP Support</a>
</li>
                            
<li>
    <a href="../midi/" class="dropdown-item">MIDI Support</a>
</li>
                            
<li>
    <a href="../soundfiles/" class="dropdown-item">Soundfiles Support</a>
</li>
                            
<li>
    <a href="../community/" class="dropdown-item">Community</a>
</li>
                            
<li>
    <a href="../faq/" class="dropdown-item">Frequently Asked Questions</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Examples <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../examples/ambisonics/" class="dropdown-item"> ambisonics </a>
</li>
                            
<li>
    <a href="../../examples/analysis/" class="dropdown-item"> analysis </a>
</li>
                            
<li>
    <a href="../../examples/bela/" class="dropdown-item"> bela </a>
</li>
                            
<li>
    <a href="../../examples/delayEcho/" class="dropdown-item"> delayEcho </a>
</li>
                            
<li>
    <a href="../../examples/dynamic/" class="dropdown-item"> dynamic </a>
</li>
                            
<li>
    <a href="../../examples/filtering/" class="dropdown-item"> filtering </a>
</li>
                            
<li>
    <a href="../../examples/gameaudio/" class="dropdown-item"> gameaudio </a>
</li>
                            
<li>
    <a href="../../examples/generator/" class="dropdown-item"> generator </a>
</li>
                            
<li>
    <a href="../../examples/misc/" class="dropdown-item"> misc </a>
</li>
                            
<li>
    <a href="../../examples/phasing/" class="dropdown-item"> phasing </a>
</li>
                            
<li>
    <a href="../../examples/physicalModeling/" class="dropdown-item"> physicalModeling </a>
</li>
                            
<li>
    <a href="../../examples/pitchShifting/" class="dropdown-item"> pitchShifting </a>
</li>
                            
<li>
    <a href="../../examples/psychoacoustic/" class="dropdown-item"> psychoacoustic </a>
</li>
                            
<li>
    <a href="../../examples/reverb/" class="dropdown-item"> reverb </a>
</li>
                            
<li>
    <a href="../../examples/smartKeyboard/" class="dropdown-item"> smartKeyboard </a>
</li>
                            
<li>
    <a href="../../examples/spat/" class="dropdown-item"> spat </a>
</li>
                            
<li>
    <a href="../../rsrc/examples.zip" class="dropdown-item"> Download examples </a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tutorials <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../workshops/2020-04-10-faust-juce/" class="dropdown-item">Faust & JUCE</a>
</li>
                            
<li>
    <a href="../../tutorials/teensy/" class="dropdown-item">DSP on the Teensy With Faust</a>
</li>
                            
<li>
    <a href="../../tutorials/esp32/" class="dropdown-item">DSP on the ESP-32 With Faust</a>
</li>
                            
<li>
    <a href="../../tutorials/basic-osc/" class="dropdown-item">Making a Sine Oscillator From Scratch</a>
</li>
                            
<li>
    <a href="../../tutorials/summation/" class="dropdown-item">RMS and Summation in Faust</a>
</li>
                            
<li>
    <a href="../../tutorials/box-api/" class="dropdown-item">Using the box API</a>
</li>
                            
<li>
    <a href="../../tutorials/signal-api/" class="dropdown-item">Using the signal API</a>
</li>
                            
<li>
    <a href="../../tutorials/julia/" class="dropdown-item">Using Faust in Julia</a>
</li>
                            
<li>
    <a href="../../tutorials/cmajor/" class="dropdown-item">Using Faust in Cmajor</a>
</li>
                            
<li>
    <a href="../../tutorials/jsfx/" class="dropdown-item">Using Faust in JSFX</a>
</li>
                            
<li>
    <a href="../../tutorials/rnbo/" class="dropdown-item">Using Faust in RNBO with codebox~</a>
</li>
                            
<li>
    <a href="../../tutorials/debugging/" class="dropdown-item">Advanced debugging with interp-tracer</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Workshops <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li>
    <a href="../../workshops/2018-12-01-paw/" class="dropdown-item"> 2018-12-01 PAW </a>
</li>
                            
<li>
    <a href="../../workshops/2020-03-24-faust-citi/" class="dropdown-item"> 2020-03-24 CITI </a>
</li>
                            
<li>
    <a href="../../workshops/2020-04-10-faust-101/" class="dropdown-item"> 2020-04-10 Faust 101 </a>
</li>
                            
<li>
    <a href="../../workshops/2020-04-10-faust-juce/" class="dropdown-item"> 2020-04-10 Faust & JUCE </a>
</li>
                            
<li>
    <a href="../../workshops/2020-11-21-faust-vcvrack/" class="dropdown-item"> 2020-11-21 Faust & VCV Rack </a>
</li>
                        </ul>
                    </li>
                    <li class="navitem">
                        <a href="../../about/" class="nav-link">About</a>
                    </li>
                </ul>

                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    

    <div class="container">
        <div class="row"><div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#embedding-the-faust-compiler-using-libfaust" class="nav-link">Embedding the Faust Compiler Using libfaust</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#dynamic-compilation-chain" class="nav-link">Dynamic Compilation Chain</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-libfaust-with-the-llvm-backend" class="nav-link">Using libfaust with the LLVM backend</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#libfaust-with-llvm-backend-api" class="nav-link">Libfaust with LLVM backend API</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#creation-api" class="nav-link">Creation API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#savingrestoring-the-factory" class="nav-link">Saving/restoring the factory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#typical-code-example" class="nav-link">Typical code example</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-libfaust-with-the-interpreter-backend" class="nav-link">Using libfaust with the Interpreter backend</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#libfaust-with-interpreter-backend-api" class="nav-link">Libfaust with Interpreter backend API</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#creation-api_1" class="nav-link">Creation API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#savingrestoring-the-factory_1" class="nav-link">Saving/restoring the factory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#performances" class="nav-link">Performances</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-libfaust-with-the-webassembly-backend" class="nav-link">Using libfaust with the WebAssembly backend</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#additional-functions" class="nav-link">Additional Functions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#sample-size-adaptation" class="nav-link">Sample size adaptation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#deployment" class="nav-link">Deployment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#additional-resources" class="nav-link">Additional Resources</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#use-case-examples" class="nav-link">Use Case Examples</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
            <div class="col-md-9 main-container" role="main">

<h1 id="embedding-the-faust-compiler-using-libfaust">Embedding the Faust Compiler Using libfaust</h1>
<h2 id="dynamic-compilation-chain">Dynamic Compilation Chain</h2>
<p>The Faust compiler uses an intermediate FIR representation (Faust Imperative Representation), which can be translated to several output languages. The FIR language describes the computation performed on the samples in a generic manner. It contains primitives to read and write variables and arrays, do arithmetic operations, and define the necessary control structures (<code>for</code> and <code>while</code> loops, <code>if</code> structure, etc.). </p>
<p>To generate various output languages, several backends have been developed for C, C++, Interpreter, Java, LLVM IR, WebAssembly, etc. The Interpreter, LLVM IR and WebAssembly ones are particularly interesting since they allow the direct compilation of a DSP program into executable code in memory, bypassing the external compiler requirement.</p>
<h2 id="using-libfaust-with-the-llvm-backend">Using libfaust with the LLVM backend</h2>
<h3 id="libfaust-with-llvm-backend-api">Libfaust with LLVM backend API</h3>
<p>The complete chain goes from the Faust DSP source code, compiled in LLVM IR using the LLVM backend, to finally produce the executable code using the LLVM JIT. All steps take place in memory, getting rid of the classical file-based approaches. Pointers to executable functions can be retrieved from the resulting LLVM module and the code directly called with the appropriate parameters.</p>
<h4 id="creation-api">Creation API</h4>
<p>The <code>libfaust</code> library exports the following API: </p>
<ul>
<li>given a Faust source code (as a string or a file), calling the <code>createDSPFactoryFromString</code> or <code>createDSPFactoryFromFile</code> functions runs the compilation chain (Faust + LLVM JIT) and generates the <em>prototype</em> of the class, as a <code>llvm_dsp_factory</code> pointer. This factory actually contains the compiled LLVM IR for the given DSP</li>
<li>alternatively the <code>createCPPDSPFactoryFromBoxes</code>allows to create the factory from a box expression built with the <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/libfaust-box.h">box API</a></li>
<li>alternatively the <code>createDSPFactoryFromSignals</code>allows to create the factory from a list of outputs signals built with the <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/libfaust-signal.h">signal API</a></li>
<li>the library keeps an internal cache of all allocated <em>factories</em> so that the compilation of the same DSP code -- that is the same source code and the same set of <em>normalized</em> (sorted in a canonical order) compilation options -- will return the same (reference counted) factory pointer </li>
<li>next, the <code>createDSPInstance</code> function (corresponding to the <code>new className</code> of C++) instantiates a <code>llvm_dsp</code> pointer to be used through its interface, connected to the audio chain and controller interfaces. When finished, <code>delete</code> can be used to destroy the dsp instance. Note that an instance internally needs to access its associated factory during its entire lifetime.   </li>
<li>since <code>llvm_dsp</code> is a subclass of the <code>dsp</code> base class, an object of this type can be used with all the available <code>audio</code> and <code>UI</code> classes. In essence, this is like reusing <a href="../architectures/">all architecture files</a> already developed for the static C++ class compilation scheme like <code>OSCUI</code>, <code>httpdUI</code> interfaces, etc.</li>
<li><code>deleteDSPFactory</code> has to be explicitly used to properly decrement the reference counter when the factory is not needed anymore, that is when all associated DSP instances have been properly destroyed</li>
<li>a unique SHA1 key of the created factory can be obtained using its <code>getSHAKey</code> method</li>
</ul>
<h4 id="savingrestoring-the-factory">Saving/restoring the factory</h4>
<p>After the DSP factory has been compiled, the application or the plugin running it might need to save it and then restore it. To get the internal factory compiled code, several functions are available:</p>
<ul>
<li><code>writeDSPFactoryToIR</code>: get the DSP factory LLVM IR (in textual format) as a string </li>
<li><code>writeDSPFactoryToIRFile</code>: get the DSP factory LLVM IR (in textual format) and write it to a file</li>
<li><code>writeDSPFactoryToBitcode</code>: get the DSP factory LLVM IR (in binary format) as a string </li>
<li><code>writeDSPFactoryToBitcodeFile</code>: save the DSP factory LLVM IR (in binary format) in a file</li>
<li><code>writeDSPFactoryToMachine</code>: get the DSP factory executable machine code as a string</li>
<li><code>writeDSPFactoryToMachineFile</code>: save the DSP factory executable machine code in a file</li>
</ul>
<p>To re-create a DSP factory from a previously saved code, several functions are available:</p>
<ul>
<li><code>readDSPFactoryFromIR</code>: create a DSP factory from a string containing the LLVM IR (in textual format) </li>
<li><code>readDSPFactoryFromIRFile</code>: create a DSP factory from a file containing the LLVM IR (in textual format)</li>
<li><code>readDSPFactoryFromBitcode</code>: create a DSP factory from a string containing the LLVM IR (in binary format)</li>
<li><code>readDSPFactoryFromBitcodeFile</code>: create a DSP factory from a file containing the LLVM IR (in binary format)</li>
<li><code>readDSPFactoryFromMachine</code>: create a DSP factory from a string containing the executable machine code</li>
<li><code>readDSPFactoryFromMachineFile</code>: create a DSP factory from a file containing the executable machine code.</li>
</ul>
<h3 id="typical-code-example">Typical code example</h3>
<p>More generally, a typical use of <code>libfaust</code> in C++ could look like:</p>
<pre><code class="language-c++">// The Faust code to compile as a string (could be in a file too)
string theCode = &quot;import(\&quot;stdfaust.lib\&quot;); process = no.noise;&quot;;

// Compiling in memory (createDSPFactoryFromFile could be used alternatively)
llvm_dsp_factory* m_factory = createDSPFactoryFromString( 
  &quot;faust&quot;, theCode, argc, argv, &quot;&quot;, m_errorString, optimize);
// creating the DSP instance for interfacing
dsp* m_dsp = m_factory-&gt;createDSPInstance();

// Creating a generic UI to interact with the DSP
my_ui* m_ui = new MyUI();
// linking the interface to the DSP instance 
m_dsp-&gt;buildUserInterface(m_ui);

// Initializing the DSP instance with the SR
m_dsp-&gt;init(44100);

// Hypothetical audio callback, assuming m_input/m_output are previously allocated 
while (...) {
  m_dsp-&gt;compute(128, m_input, m_output);
}

// Cleaning
// Manually delete the DSP
delete m_dsp;
delete m_ui;
// The factory actually keeps track of all allocated DSP (done in createDSPInstance).
// So if not manually deleted, all remaining DSP will be garbaged here.
deleteDSPFactory(m_factory);
</code></pre>
<p>The first step consists in creating a DSP factory from a DSP file (using <code>createDSPFactoryFromFile</code>) or string  (using <code>createDSPFactoryFromString</code>) with additional parameters given to the compiler. Assuming the compilation works, a factory is returned, to create a DSP instance with the factory <code>createDSPInstance</code> method. </p>
<p>Note that the resulting <code>llvm_dsp*</code> pointer type (see <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/llvm-dsp.h"><code>faust/dsp/llvm-dsp.h</code></a> header file) is a subclass of the base <code>dsp</code> class (see <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/dsp.h"><code>faust/dsp/dsp.h</code></a> header file). Thus it can be used with any <code>UI</code> type to plug a GUI, MIDI or OSC controller on the DSP object, like it would be done with a DSP program compiled to a C++ class (the generated <code>mydsp</code>  class is also a subclass of the base <code>dsp</code> class). This is demonstrated with the <code>my_ui* m_ui = new MyUI();</code> and <code>m_dsp-&gt;buildUserInterface(m_ui);</code> lines where the <code>buildUserInterface</code> method is used to connect a controller. </p>
<p>Then the DSP object has to be connected to an audio driver to be rendered (see the <code>m_dsp-&gt;compute(128, m_input, m_output);</code> block). A more complete C++ example can be <a href="https://github.com/grame-cncm/faust/blob/master-dev/tests/llvm-tests/llvm-test.cpp">found here</a>. A example using the pure C API can be <a href="https://github.com/grame-cncm/faust/blob/master-dev/tests/llvm-tests/llvm-test.c">found here</a>. </p>
<h2 id="using-libfaust-with-the-interpreter-backend">Using libfaust with the Interpreter backend</h2>
<p>When compiled to embed the <a href="https://github.com/grame-cncm/faust/tree/master-dev/compiler/generator/interpreter">Interpreter backend</a>, <code>libfaust</code> can also be used to generate the Faust Bytes Code (FBC) format and interpret it in memory.</p>
<h3 id="libfaust-with-interpreter-backend-api">Libfaust with Interpreter backend API</h3>
<p>The interpreter backend (described in <a href="http://www.ifc18.uni-mainz.de/papers/letz.pdf">this paper</a>) has been first written to allow dynamical compilation on iOS, where Apple does not allow LLVM based JIT compilation to be deployed, but can also be used to <a href="../debugging/#the-interp-tracer-tool">develop testing tools</a>. It has been defined as a typed bytecode and a virtual machine to execute it.</p>
<p>The FIR language is simple enough to be easily translated in the typed bytecode for an interpreter, generated by a FIR to bytecode compilation pass. The virtual machine then executes the bytecode on a stack based machine.</p>
<h4 id="creation-api_1">Creation API</h4>
<p>The interpreter backend API is similar to the LLVM backend API: </p>
<ul>
<li>given a FAUST source code (as a file or a string),  calling the <code>createInterpreterDSPFactory</code>  function runs the compilation chain (Faust + interpreter backend) and generates the <em>prototype</em> of the class, as an <code>interpreter_dsp_factory</code> pointer. This factory actually contains the compiled bytecode for the given DSP</li>
<li>alternatively the <code>createInterpreterDSPFactoryFromBoxes</code> allows to create the factory from a box expression built with the <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/libfaust-box.h">box API</a></li>
<li>alternatively the <code>createInterpreterDSPFactoryFromSignals</code> allows to create the factory from a list of outputs signals built with the <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/libfaust-signal.h">signal API</a></li>
<li>the library keeps an internal cache of all allocated <em>factories</em> so that the compilation of the same DSP code -- that is the same source code and the same set of <em>normalized</em> (sorted in a canonical order) compilation options -- will return the same (reference counted) factory pointer </li>
<li>next, the <code>createDSPInstance</code> method of the factory class, corresponding to the <code>new className</code> of C++, instantiates an <code>interpreter_dsp</code> pointer, to be used as any regular Faust compiled DSP object, run and controlled through its interface. The instance contains the interpreter virtual machine loaded with the compiled bytecode, to be executed for each method. When finished, <code>delete</code> can be used to destroy the dsp instance. Note that an instance internally needs to access its associated factory during its entire lifetime. </li>
<li>since <code>interpreter_dsp</code> is a subclass of the <code>dsp</code> base class, an object of this type can be used with all the available <code>audio</code> and <code>UI</code> classes. In essence, this is like reusing <a href="../architectures/">all architecture files</a> already developed for the static C++ class compilation scheme like <code>OSCUI</code>, <code>httpdUI</code> interfaces, etc.</li>
<li><code>deleteInterpreterDSPFactory</code> has to be explicitly used to properly decrement the reference counter when the factory is not needed anymore, that is when all associated DSP instances have been properly destroyed. </li>
<li>a unique SHA1 key of the created factory can be obtained using its <code>getSHAKey</code> method</li>
</ul>
<h4 id="savingrestoring-the-factory_1">Saving/restoring the factory</h4>
<p>After the DSP factory has been compiled, the application or plugin may want to save/restore it in order to save Faust to interpreter bytecode compilation at next use. To get the internal factory bytecode and save it, two functions are available:</p>
<ul>
<li><code>writeInterpreterDSPFactoryToMachine</code> allows to get the interpreter bytecode as a string</li>
<li><code>writeInterpreterDSPFactoryToMachineFile</code> allows to save the interpreter bytecode in a file</li>
</ul>
<p>To re-create a DSP factory from a previously saved code, two functions are available:</p>
<ul>
<li><code>readInterpreterDSPFactoryFromMachine</code>allows to create a DSP factory from a string containing the interpreter bytecode</li>
<li><code>readInterpreterDSPFactoryFromMachineFile</code> allows to create a DSP factory from a file containing the interpreter bytecode</li>
</ul>
<p>The complete API is available and documented in the installed <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/interpreter-dsp.h">faust/dsp/interpreter-dsp.h</a> header. Note that only the scalar compilation mode is supported. A more complete C++ example can be <a href="https://github.com/grame-cncm/faust/blob/master-dev/tests/interp-tests/interp-test.cpp">found here</a>. </p>
<h3 id="performances">Performances</h3>
<p>The generated code is obviously much slower than LLVM generated native code. Measurements on various DSPs examples have been done, and the code is between 3 and more than 10 times slower than the LLVM native code.</p>
<h2 id="using-libfaust-with-the-webassembly-backend">Using libfaust with the WebAssembly backend</h2>
<p>The libfaust C++ library can be compiled in WebAssembly with <a href="https://emscripten.org/">Emscripten</a>, and used in the web  or NodeJS platforms. A <a href="../deploying/">specific page on the subject</a> is available. </p>
<h2 id="additional-functions">Additional Functions</h2>
<p>Some additional functions are available in the <code>libfaust</code> API:</p>
<ul>
<li>
<p><strong>Expanding the DSP code</strong>. The<code>expandDSPFromString</code>/<code>expandDSPFromFile</code> functions can be used to generate a self-contained DSP source string where all needed librairies have been included. All compilations options are normalized and included as a comment in the expanded string. This is a way to create self-contained version of DSP programs.</p>
</li>
<li>
<p><strong>Using other backends or generating auxiliary files</strong>. The <code>generateAuxFilesFromString</code> and <code>generateAuxFilesFromFile</code> functions taking a DSP source string or file can be used:</p>
<ul>
<li>to activate and use other backends (depending of which ones have been compiled in libfaust) to generate like C, C++, or Cmajor code, etc. The <code>argv</code> parameter has to mimic the command line like for instance: <code>-lang cpp -vec -lv 1</code> to generate a C++ file in vector mode.</li>
<li>to generate auxiliary files which can be text files SVG, XML, ps, etc. The <code>argv</code> parameter has to mimic the command line like for instance: <code>-json</code> to generate a JSON file.</li>
</ul>
</li>
</ul>
<h2 id="sample-size-adaptation">Sample size adaptation</h2>
<p>When compiled with the <code>-double</code> option, the generated code internally uses <code>double</code> format for samples, but also expects inputs/outputs buffers to be filled with samples in double. The <code>dsp_sample_adapter</code> decorator class defined in <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/dsp-adapter.h">faust/dsp/dsp-adapter.h</a> can be used to adapt the buffers. </p>
<h2 id="deployment">Deployment</h2>
<p>The application or plugin using <code>libfaust</code> can embed the library either as a statically linked component (to get a self-contained binary) or provided as a separate component to be loaded dynamically at runtime. The Faust libraries themselves usually have to be bundled separately and can be accessed at runtime using the compiler <code>-I /path/to/libraries</code> option in <code>createDSPFactoryFromString/createDSPFactoryFromFile</code> functions.</p>
<h2 id="additional-resources">Additional Resources</h2>
<p>Some papers and tutorials are available:</p>
<ul>
<li><a href="https://hal.archives-ouvertes.fr/hal-00832224">Comment Embarquer le Compilateur Faust dans Vos Applications ?</a></li>
<li><a href="https://hal.archives-ouvertes.fr/hal-02158929">An Overview of the FAUST Developer Ecosystem</a></li>
<li><a href="../../tutorials/box-api/">Using the box API</a></li>
<li><a href="../../tutorials/signal-api/">Using the signal API</a></li>
</ul>
<h2 id="use-case-examples">Use Case Examples</h2>
<p>The dynamic compilation chain has been used in several projects:</p>
<ul>
<li>
<p><a href="https://github.com/grame-cncm/faustlive">FaustLive</a>: an integrated IDE for Faust development offering on-the-fly compilation and execution features</p>
</li>
<li>
<p><a href="https://github.com/grame-cncm/faust/tree/master-dev/embedded/faustgen">Faustgen</a>: a generic Faust <a href="https://cycling74.com/products/max/">Max/MSP</a> programmable external object</p>
</li>
<li>
<p><a href="https://github.com/CICM/pd-faustgen">Faustgen</a>: a generic Faust <a href="https://puredata.info">PureData</a> programmable external object</p>
</li>
<li>
<p>The <a href="https://github.com/agraef/pd-faustgen">faustgen2~</a> object is a Faust external for Pd a.k.a. Pure Data, Miller Puckette's interactive multimedia programming environment</p>
</li>
<li>
<p><a href="https://github.com/csound/csound/blob/develop/Opcodes/faustgen.cpp">Faust for Csound</a>: a <a href="https://csound.com/">Csound</a> opcode running the Faust compiler internally</p>
</li>
<li>
<p><a href="https://github.com/sletz/libaudiostream">LibAudioStream</a>: a framework to manipulate audio ressources through the concept of streams</p>
</li>
<li>
<p><a href="https://github.com/olilarkin/juce_faustllvm">Faust for JUCE</a>: a tool integrating the Faust compiler to <a href="https://juce.com/">JUCE</a> developed by Oliver Larkin and available as part of the <a href="https://github.com/olilarkin/pMix2">pMix2 project</a></p>
</li>
<li>
<p>An experimental integration of Faust in <a href="http://forumnet.ircam.fr/product/antescofo-en/">Antescofo</a></p>
</li>
<li>
<p><a href="https://github.com/ccrma/chugins/tree/main/Faust">FaucK</a>: the combination of the <a href="http://chuck.cs.princeton.edu/">ChucK Programming Language</a> and Faust</p>
</li>
<li>
<p><a href="https://github.com/ossia/libossia">libossia</a> is a modern C++, cross-environment distributed object model for creative coding. It is used in <a href="https://github.com/ossia/score">Ossia score</a> project</p>
</li>
<li>
<p><a href="https://users.notam02.no/~kjetism/radium/">Radium</a> is a music editor with a new type of interface, including a Faust audio DSP development environment using libfaust with the LLVM and Interpreter backends</p>
</li>
<li>
<p><a href="https://git.open-music-kontrollers.ch/~hp/mephisto.lv2">Mephisto LV2</a> is a Just-in-Time Faust compiler embedded in an LV2 plugin, using the C API.</p>
</li>
<li>
<p><a href="https://github.com/Gwion/gwion-plug/tree/master/Faust">gwion-plug</a> is a Faust plugin for the <a href="https://github.com/Gwion/Gwion">Gwion</a> programming language. </p>
</li>
<li>
<p><a href="https://github.com/madskjeldgaard/faustgen-supercollider/">FaustGen</a> allows to livecode Faust in SuperCollider. It uses the libfaust LLVM C++ API.</p>
</li>
<li>
<p><a href="https://github.com/marcecj/faust_python">FAUSTPy</a> is a Python wrapper for the Faust DSP language. It is implemented using the CFFI and hence creates the wrapper dynamically at run-time. A updated version of the project is available on <a href="https://github.com/hrtlacek/faust_python">this fork</a>.</p>
</li>
<li>
<p><a href="https://github.com/corajr/Faust.jl">Faust.jl</a> is Julia wrapper for the Faust compiler. It uses the libfaust LLVM C API.</p>
</li>
<li>
<p><a href="https://gitlab.com/raoulhc/fl-tui">fl-tui</a> is a Rust wrapper for the Faust compiler. It uses the libfaust LLVM C API.</p>
</li>
<li>
<p><a href="https://codeberg.org/obsoleszenz/faustlive-jack-rs">faustlive-jack-rs</a> is another Rust wrapper for the Faust compiler, using <a href="https://jackaudio.org">JACK</a> server for audio. It uses the libfaust LLVM C API.</p>
</li>
<li>
<p><a href="https://github.com/DBraun/DawDreamer">DawDreamer</a> is an audio-processing Python framework supporting core DAW features. It uses the libfaust LLVM C API.</p>
</li>
<li>
<p><a href="https://github.com/dblanchemain/metaSurface">metaSurface64</a> is a real-time continuous sound transformation control surface that features both its own loop generator for up to 64 voices and a multi-effects FX engine.  It uses the libfaust LLVM C++ API.</p>
</li>
<li>
<p><a href="https://faust.grame.fr/community/powered-by-faust/#metafx">metaFx</a> is a control surface for continuous sound transformations in real time, just like the metaSurface64.
Like metaSurface64, it has both its own loop generator and a multi-effects FX engine, but its operation is different, especially for the management of plugin chains and pads.</p>
</li>
<li>
<p><a href="http://www.hise.audio">HISE</a> is an open source framework for building sample based virtual instruments combining a highly performant Disk-Streaming Engine, a flexible DSP-Audio Module system and a handy Interface Designer.</p>
</li>
<li>
<p><a href="https://github.com/glocq/Amati">AMATI</a> is a VST plugin for live-coding effects in the Faust programming language.</p>
</li>
<li>
<p><a href="https://github.com/shakfu/cyfaust">cyfaust</a> is a cython wrapper of the Faust interpreter and the RtAudio cross-platform audio driver, derived from the <a href="https://github.com/shakfu/faustlab">faustlab</a> project. The objective is to end up with a minimal, modular, self-contained, cross-platform python3 extension.</p>
</li>
<li>
<p><a href="https://github.com/YPares/nih-faust-jit">nih-faust-jit</a> ia a plugin written in Rust to load Faust dsp files and JIT-compile them with LLVM. A simple GUI is provided to select which script to load and where to look for the Faust libraries that this script may import. The selected DSP script is saved as part of the plugin state and therefore is saved with your DAW project.</p>
</li>
</ul></div>
        </div>
    </div>

    <footer class="col-md-12">
        <hr>
        <p>Copyright &copy; 2020-2025 <a href="https://www.grame.fr">Grame-CNCM</a></p>
    </footer>
    <script>
        var base_url = "../..",
        shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
    </script>
    <script src="../../js/base.js" defer></script>
    <script src="/js/faust-web-component.js" defer></script>
    <script src="../../search/main.js" defer></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
