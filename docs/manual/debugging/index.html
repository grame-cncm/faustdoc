<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Debugging the Code - Faust Documentation</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="/css/quickref.css" rel="stylesheet">
        <link href="/rail/railroad-diagrams.css" rel="stylesheet">

        <script src="../../js/jquery-3.6.0.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../.."><img src="../../img/faustText.svg" width="150px"> </a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Manual <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../overview/" class="dropdown-item">Overview of the Faust Universe</a>
</li>
                                    
<li>
    <a href="../quick-start/" class="dropdown-item">Quick Start</a>
</li>
                                    
<li>
    <a href="../syntax/" class="dropdown-item">Faust Syntax</a>
</li>
                                    
<li>
    <a href="../errors/" class="dropdown-item">Error Messages</a>
</li>
                                    
<li>
    <a href="../compiler/" class="dropdown-item">Using the Compiler</a>
</li>
                                    
<li>
    <a href="../options/" class="dropdown-item">Compiler Options</a>
</li>
                                    
<li>
    <a href="../tools/" class="dropdown-item">faust2[...] Tools</a>
</li>
                                    
<li>
    <a href="../architectures/" class="dropdown-item">Architecture Files</a>
</li>
                                    
<li>
    <a href="../embedding/" class="dropdown-item">Embedding the Compiler</a>
</li>
                                    
<li>
    <a href="../optimizing/" class="dropdown-item">Optimizing the Code</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Debugging the Code</a>
</li>
                                    
<li>
    <a href="../deploying/" class="dropdown-item">Deploying on the Web</a>
</li>
                                    
<li>
    <a href="../remote/" class="dropdown-item">Remote Compilation</a>
</li>
                                    
<li>
    <a href="../mathdoc/" class="dropdown-item">Mathematical Documentation</a>
</li>
                                    
<li>
    <a href="../osc/" class="dropdown-item">OSC Support</a>
</li>
                                    
<li>
    <a href="../http/" class="dropdown-item">HTTP Support</a>
</li>
                                    
<li>
    <a href="../midi/" class="dropdown-item">MIDI Support</a>
</li>
                                    
<li>
    <a href="../soundfiles/" class="dropdown-item">Soundfiles Support</a>
</li>
                                    
<li>
    <a href="../community/" class="dropdown-item">Community</a>
</li>
                                    
<li>
    <a href="../faq/" class="dropdown-item">Frequently Asked Questions</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../examples/ambisonics/" class="dropdown-item"> ambisonics </a>
</li>
                                    
<li>
    <a href="../../examples/analysis/" class="dropdown-item"> analysis </a>
</li>
                                    
<li>
    <a href="../../examples/bela/" class="dropdown-item"> bela </a>
</li>
                                    
<li>
    <a href="../../examples/delayEcho/" class="dropdown-item"> delayEcho </a>
</li>
                                    
<li>
    <a href="../../examples/dynamic/" class="dropdown-item"> dynamic </a>
</li>
                                    
<li>
    <a href="../../examples/filtering/" class="dropdown-item"> filtering </a>
</li>
                                    
<li>
    <a href="../../examples/gameaudio/" class="dropdown-item"> gameaudio </a>
</li>
                                    
<li>
    <a href="../../examples/generator/" class="dropdown-item"> generator </a>
</li>
                                    
<li>
    <a href="../../examples/misc/" class="dropdown-item"> misc </a>
</li>
                                    
<li>
    <a href="../../examples/phasing/" class="dropdown-item"> phasing </a>
</li>
                                    
<li>
    <a href="../../examples/physicalModeling/" class="dropdown-item"> physicalModeling </a>
</li>
                                    
<li>
    <a href="../../examples/pitchShifting/" class="dropdown-item"> pitchShifting </a>
</li>
                                    
<li>
    <a href="../../examples/psychoacoustic/" class="dropdown-item"> psychoacoustic </a>
</li>
                                    
<li>
    <a href="../../examples/reverb/" class="dropdown-item"> reverb </a>
</li>
                                    
<li>
    <a href="../../examples/SAM/" class="dropdown-item"> SAM </a>
</li>
                                    
<li>
    <a href="../../examples/smartKeyboard/" class="dropdown-item"> smartKeyboard </a>
</li>
                                    
<li>
    <a href="../../examples/spat/" class="dropdown-item"> spat </a>
</li>
                                    
<li>
    <a href="../../rsrc/examples.zip" class="dropdown-item"> Download examples </a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../workshops/2020-04-10-faust-juce/" class="dropdown-item">Faust & JUCE</a>
</li>
                                    
<li>
    <a href="../../tutorials/teensy/" class="dropdown-item">DSP on the Teensy With Faust</a>
</li>
                                    
<li>
    <a href="../../tutorials/esp32/" class="dropdown-item">DSP on the ESP-32 With Faust</a>
</li>
                                    
<li>
    <a href="../../tutorials/basic-osc/" class="dropdown-item">Making a Sine Oscillator From Scratch</a>
</li>
                                    
<li>
    <a href="../../tutorials/summation/" class="dropdown-item">RMS and Summation in Faust</a>
</li>
                                    
<li>
    <a href="../../tutorials/box-api/" class="dropdown-item">Using the box API</a>
</li>
                                    
<li>
    <a href="../../tutorials/signal-api/" class="dropdown-item">Using the signal API</a>
</li>
                                    
<li>
    <a href="../../tutorials/julia/" class="dropdown-item">Using Faust in Julia</a>
</li>
                                    
<li>
    <a href="../../tutorials/cmajor/" class="dropdown-item">Using Faust in Cmajor</a>
</li>
                                    
<li>
    <a href="../../tutorials/jsfx/" class="dropdown-item">Using Faust in JSFX</a>
</li>
                                    
<li>
    <a href="../../tutorials/rnbo/" class="dropdown-item">Using Faust in RNBO with codebox~</a>
</li>
                                    
<li>
    <a href="../../tutorials/debugging/" class="dropdown-item">Advanced debugging with interp-tracer</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Workshops <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../workshops/2018-12-01-paw/" class="dropdown-item"> 2018-12-01 PAW </a>
</li>
                                    
<li>
    <a href="../../workshops/2020-03-24-faust-citi/" class="dropdown-item"> 2020-03-24 CITI </a>
</li>
                                    
<li>
    <a href="../../workshops/2020-04-10-faust-101/" class="dropdown-item"> 2020-04-10 Faust 101 </a>
</li>
                                    
<li>
    <a href="../../workshops/2020-04-10-faust-juce/" class="dropdown-item"> 2020-04-10 Faust & JUCE </a>
</li>
                                    
<li>
    <a href="../../workshops/2020-11-21-faust-vcvrack/" class="dropdown-item"> 2020-11-21 Faust & VCV Rack </a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        

        <div class="container">
            <div class="row"><div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#debugging-the-code" class="nav-link">Debugging the Code</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#looking-at-the-generated-code" class="nav-link">Looking at the generated code</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#using-the-fir-backend" class="nav-link">Using the FIR backend</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#debugging-the-dsp-code" class="nav-link">Debugging the DSP Code</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#debugging-at-compile-time" class="nav-link">Debugging at compile time</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#the-ct-option" class="nav-link">The -ct option</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#the-me-option" class="nav-link">The -me option</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#debugging-at-runtime" class="nav-link">Debugging at runtime</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="4"><a href="#the-interp-tracer-tool" class="nav-link">The interp-tracer tool</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="4"><a href="#the-faust2caqt-tool" class="nav-link">The faust2caqt tool</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#fixing-the-errors" class="nav-link">Fixing the errors</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#additional-resources" class="nav-link">Additional Resources</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9 main-container" role="main">

<h1 id="debugging-the-code">Debugging the Code</h1>
<h2 id="looking-at-the-generated-code">Looking at the generated code</h2>
<h3 id="using-the-fir-backend">Using the FIR backend</h3>
<p>The FIR (Faust Imperative Representation) backend can possibly be used to look at a textual version of the intermediate imperative language. </p>
<pre><code>import(&quot;stdfaust.lib&quot;);

vol = hslider(&quot;volume [unit:dB]&quot;, 0, -96, 0, 0.1) : ba.db2linear : si.smoo;
freq1 = hslider(&quot;freq1 [unit:Hz]&quot;, 1000, 20, 3000, 1);
freq2 = hslider(&quot;freq2 [unit:Hz]&quot;, 200, 20, 3000, 1);

process = vgroup(&quot;Oscillator&quot;, os.osc(freq1) * vol, os.osc(freq2) * vol);
</code></pre>
<p>For instance compiling the previous code with the <code>faust -lang fir osc.dsp</code> command will display various statistics, for example the number of operations done in the generated <code>compute</code> method:</p>
<pre><code>======= Compute DSP begin ==========
Instructions complexity : Load = 23 Store = 9 
Binop = 12 [ { Int(+) = 1 } { Int(&lt;) = 1 } { Real(*) = 3 } { Real(+) = 5 } { Real(-) = 2 } ] 
Mathop = 2 [ { floorf = 2 } ] 
Numbers = 8 
Declare = 1 
Cast = 2 
Select = 0 
Loop = 1
</code></pre>
<p>As well as the DSP structure memory size and layout, and read/write statistics:</p>
<pre><code>======= Object memory footprint ==========

Heap size int = 4 bytes
Heap size int* = 0 bytes
Heap size real = 48 bytes
Total heap size = 68 bytes
Stack size in compute = 28 bytes

======= Variable access in compute control ==========

Field = fSampleRate size = 1 r_count = 0 w_count = 0
Field = fConst1 size = 1 r_count = 1 w_count = 0
Field = fHslider0 size = 1 r_count = 1 w_count = 0
Field = fConst2 size = 1 r_count = 0 w_count = 0
Field = fRec0 size = 2 r_count = 0 w_count = 0
Field = fConst3 size = 1 r_count = 2 w_count = 0
Field = fHslider1 size = 1 r_count = 1 w_count = 0
Field = fRec2 size = 2 r_count = 0 w_count = 0
Field = fHslider2 size = 1 r_count = 1 w_count = 0
Field = fRec3 size = 2 r_count = 0 w_count = 0

======= Variable access in compute DSP ==========

Field = fSampleRate size = 1 r_count = 0 w_count = 0
Field = fConst1 size = 1 r_count = 0 w_count = 0
Field = fHslider0 size = 1 r_count = 0 w_count = 0
Field = fConst2 size = 1 r_count = 1 w_count = 0
Field = fRec0 size = 2 r_count = 4 w_count = 2
Field = fConst3 size = 1 r_count = 0 w_count = 0
Field = fHslider1 size = 1 r_count = 0 w_count = 0
Field = fRec2 size = 2 r_count = 4 w_count = 2
Field = fHslider2 size = 1 r_count = 0 w_count = 0
Field = fRec3 size = 2 r_count = 4 w_count = 2
</code></pre>
<p>Those informations can possibly be used to detect abnormal memory consumption. </p>
<h2 id="debugging-the-dsp-code">Debugging the DSP Code</h2>
<p>On a computer, doing a computation that is undefined in mathematics (like <code>val/0</code> of <code>log(-1)</code>), and unrepresentable in floating-point arithmetic, will produce a <a href="https://en.wikipedia.org/wiki/NaN">NaN</a> value, which has a <a href="https://en.cppreference.com/w/cpp/numeric/math/NAN">special internal representation</a>. Similarly, some computations will exceed the range that is representable with floating-point arithmetics, and are represented with a special <a href="https://en.cppreference.com/w/cpp/numeric/math/INFINITY">INFINITY</a> value, which value depends of the choosen type (like <code>float</code>, <code>double</code> or <code>long double</code>).</p>
<p>After being produced, those values can actually <em>contaminate</em> the following flow of computations (that is <code>Nan + any value = NaN</code> for instance) up to the point of producing incorrect indexes when used in array access, and causing memory access crashes.  </p>
<p>The Faust compiler gives error messages when the written code is not syntactically or semantically correct, and the interval computation system on signals is supposed to detect possible problematic computations at compile time, and refuse to compile the corresponding DSP code.  But <em>the interval calculation is currently quite imperfect</em>, can misbehave, and possibly allow problematic code to be generated.</p>
<p>Several strategies have been developed to help programmers better understand their written DSP code, and possibly analyse it, both at compile time and runtime.</p>
<h3 id="debugging-at-compile-time">Debugging at compile time</h3>
<h4 id="the-ct-option">The -ct option</h4>
<p>Using the <code>-ct</code> compilation option allows to check table index range and generate safe table access code. It verifies that the signal range is compatible with the  table size, and if needed, generate safe read and write indexes access code, by constraining them to stay in a given <code>[0.. size-1]</code> range. </p>
<p>Note that since the signal interval calculation is imperfect, you may see <em>false positives</em>, and uneeded range constraining code might be generated, especially when using recursive signals where the interval calculation system will typically produce <em>[-inf, inf]</em> range, which is not precise enough to correctly describe the real signal range.  </p>
<h4 id="the-me-option">The -me option</h4>
<p>Starting with version 2.37.0, mathematical functions which have a finite domain (like <code>sqrt</code> defined for positive or null values, or <code>asin</code> defined for values in the [-1..1] range) are <em>checked at compile time</em> when they <em>actually compute values at that time</em>, and <em>raise an error</em> if the program tries to compute an out-of-domain value.  If those functions appear in the generated code, their domain of use can also be checked (using the interval computation system) and  the <code>-me</code> option <em>will display warnings</em> if the domain of use is incorrect. Note that again because of the imperfect interval computation system, <em>false positives</em> may appear and should be checked.</p>
<h3 id="debugging-at-runtime">Debugging at runtime</h3>
<h4 id="the-interp-tracer-tool">The interp-tracer tool</h4>
<p>The  <strong>interp-tracer</strong> tool runs and instruments the compiled program using the Interpreter backend. Various statistics on the code are collected and displayed while running and/or when closing the application, typically <code>FP_SUBNORMAL</code>, <code>FP_INFINITE</code> and <code>FP_NAN</code> values, or <code>INTEGER_OVERFLOW</code>, <code>CAST_INT_OVERFLOW</code>  and <code>DIV_BY_ZERO</code> operations, or <code>LOAD/STORE</code> errors. </p>
<p>See the <a href="https://github.com/grame-cncm/faust/tree/master-dev/tools/benchmark#interp-tracer">complete documentation</a> and the <a href="https://faustdoc.grame.fr/tutorials/debugging/">Advanced debugging with interp-tracer</a> tutorial.</p>
<h4 id="the-faust2caqt-tool">The faust2caqt tool</h4>
<p>On macOS, the <a href="https://faustdoc.grame.fr/manual/tools/#faust2caqt">faust2caqt</a> script has a <code>-me</code> option to catch math computation exceptions (floating point exceptions and integer div-by-zero or overflow, etc.) at runtime. Developers can possibly use the <a href="https://github.com/grame-cncm/faust/blob/master-dev/architecture/faust/dsp/dsp-checker.h#L42">dsp_me_checker</a> class to decorate a given DSP object with the math computation exception handling code. </p>
<h3 id="fixing-the-errors">Fixing the errors</h3>
<p>These errors must then be corrected by carefully checking signal range, like verifying the min/max values in <code>vslider/hslider/nentry</code> user-interface items. </p>
<h3 id="additional-resources">Additional Resources</h3>
<p>Note that the Faust <a href="https://faustlibraries.grame.fr/libs/maths/">math library</a> contains the implementation of <code>isnan</code> and <code>isinf</code>  functions that may help during development.</p>
<p>Handling infinity and not-a-number (NaN) the right way still remains a tricky problem that is not completely handled in the current version of the compiler. Dario Sanfilippo <a href="https://www.dariosanfilippo.com/blog/2020/handling_inf_nan_values_in_faust_and_cpp/">blog post</a> is a very helpful summary of the situation with a lot of practical solutions to <a href="https://github.com/dariosanfilippo/realfaust/blob/main/realfaust.lib">write safer DSP code</a>.  </p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020-2024 <a href="https://www.grame.fr">Grame-CNCM</a></p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

        <script src="https://cdn.jsdelivr.net/npm/@grame/faust-web-component@0.2.25/dist/faust-web-component.js" defer></script>
    </body>
</html>
